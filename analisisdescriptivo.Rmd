---
title: "análisis descriptivo"
output: html_document
date: "2026-01-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
df <- read_csv("prado_variables.csv")

df$exito <- as.factor(df$exito)
df$tam_cat <- factor(
  df$tam_cat,
  levels = c("0", "1-10", "11-98", "99", "+100"),
  ordered = TRUE
)
df$soporte_grp <-as.factor(df$soporte_grp)
df$sop_montaje <-as.factor(df$sop_montaje)
df$tecnica <- as.factor(df$tecnica)
df$tipo_autor <- as.factor(df$tipo_autor)
df$serie <- as.factor(df$serie)
df$fecha_est <- as.integer(df$fecha_est)
df$fecha_cat <- factor(
  df$fecha_cat,
  levels = c("0", "1-10", "11-98", "99", "+100"),
  ordered = TRUE
)
df$tema <- as.factor(df$tema)

```

Empezamos el análisis descriptivo construyendo para cada variable, una tabla de frecuencias y el gráfico de barras correspondiente, la forma más directa de entender cómo se reparte la información dentro del conjunto de datos. Antes de comparar con la variable respuesta (exito) o plantear cualquier modelo, necesitamos saber qué categorías aparecen, con qué peso y si existe algún patrón evidente en la composición de la muestra. 

Como control de calidad permite detectar problemas típicos en datos obtenidos por web scraping, como etiquetas duplicadas, niveles inesperados o valores codificados de manera especial.

Las frecuencias son necesarias para interpretar correctamente lo que venga después. 
Si tenemos una categoría muy mayoritaria cualquier resultado puede estar condicionado por esa dominancia. Tener la proporción de cada nivel ayuda a contextualizar comparaciones; no es lo mismo observar un patrón en una categoría con miles de obras que en otra con muy pocas. 

Las clases minoritarias aun que ess habitual que algunas categorías tengan pocas observaciones.Si tenemos demasiados niveles con baja frecuencia hacen que los gráficos sean ilegibles y no podamos extraer conclusiones.

En resumen, trabajar variable por variable es una etapa imprescindible porque permite verificar la coherencia de las variables, comprender la estructura real de los datos y anticipar problemas derivados de categorías raras. Esto asegura que las comparaciones posteriores con exito sean interpretables, estables y defendibles.


#exito 

```{r}
table(df$exito)

v <- "exito"
tab <- sort(table(df[[v]]), decreasing = TRUE)

names(tab)[names(tab) == "0"] <- "0 (no cumple)"
names(tab)[names(tab) == "1"] <- "1 (cumple)"

# gráfico
barplot(tab, las = 1, main = "¿Cumple la proporción áurea?", ylab = "frequencia")

```

# area ¿???¿?¿? MIRAR LO DEL LOG 

```{r}
hist(log1p(df$area), breaks = "FD", main = "Histograma de log1p(area)", xlab = "log1p(area)")
plot(density(log1p(df$area)), main = "Densidad de log1p(area)", xlab = "log1p(area)")

```
## miramos la distribución de area y si esta sesgada
Útil para ver si necesitas log(area+1) y detectar valores extremos.
```{r}
hist(df$area, breaks=40, main="Histograma de área", xlab="area")
hist(log(df$area ), breaks=40, main="Histograma de log(area+1)", xlab="log(area)")
boxplot(df$area, main="Boxplot área", ylab="area")
boxplot(log(df$area), main="Boxplot log(area+1)", ylab="log(area+1)")

```
El área está muy sesgada a la derecha: la mayoría de obras tienen áreas pequeñas y hay pocas con áreas enormes (por eso el histograma “normal” queda aplastado y el boxplot de area sale con mil outliers).

Al hacer log(area) la distribución queda mucho más “normalita” (campana) y el boxplot se vuelve legible → para comparar áreas entre grupos (tema, técnica, éxito, etc.)

#tam_cat

```{r}
table(df$tam_cat)

v <- "tam_cat"
tab <- sort(table(df[[v]]), decreasing = TRUE)

# gráfico
barplot(tab, las = 1, main = "Tamaño", ylab = "frequencia")

```

#orientación
```{r}
table(df$orientacion)

v <- "orientacion"
tab <- sort(table(df[[v]]), decreasing = TRUE)

# gráfico
barplot(tab, las = 1, main = "Orientación", ylab = "frequencia")

```

#soporte_grp

```{r}
table(df$soporte_grp)

v <- "soporte_grp"
tab <- sort(table(df[[v]]), decreasing = TRUE)

# gráfico
barplot(tab, las = 1, main = "??¿?¿?", ylab = "frequencia")

```

#sop_montaje

```{r}
table(df$sop_montaje)

v <- "sop_montaje"
tab <- sort(table(df[[v]]), decreasing = TRUE)

names(tab)[names(tab) == "0"] <- "No ?¿?¿"
names(tab)[names(tab) == "1"] <- "Sí ?¿?¿?"

# gráfico
barplot(tab, las = 1, main = "Soportes", ylab = "frequencia")

```

#dummies *****


#tipo_autor
```{r}
table(df$tipo_autor)

v <- "tipo_autor"
tab <- sort(table(df[[v]]), decreasing = TRUE)

# gráfico
barplot(tab, las = 1, main = "Tipo de Autor", ylab = "frequencia")

```
#serie

```{r}
table(df$serie)

v <- "serie"
tab <- sort(table(df[[v]]), decreasing = TRUE)
names(tab)[names(tab) == "0"] <- "0 (No)"
names(tab)[names(tab) == "1"] <- "1 (Sí)"

# gráfico
barplot(tab, las = 1, main = "Forma parte de una serie", ylab = "frequencia")

```

#fecha_est.  ###### LOG ?¿?¿=??
```{r}
table(df$fecha_est)

v <- "fecha_est"
tab <- sort(table(df[[v]]), decreasing = FALSE)

# gráfico
barplot(tab, las = 1, main = "Fecha Estimada", ylab = "frequencia")

```

#fecha_ancho
```{r}
table(df$fecha_ancho)

v <- "fecha_ancho"
tab <- sort(table(df[[v]]), decreasing = TRUE)

# gráfico
boxplot(tab, main = "Variabidad de la Fecha")

```

#tema 
```{r}
table(df$tema)

v <- "tema"
tab <- sort(table(df[[v]]), decreasing = TRUE)

# gráfico
barplot(tab, las = 2, main = "Tema de la Obra", ylab = "frequencia")

```



#pairs
```{r}
vars_num <- c( "area", "razon", "fecha_est")
vars_num <- vars_num[vars_num %in% names(df)]

df_num <- df[, vars_num, drop = FALSE]

set.seed(1)
idx <- sample(nrow(df_num), min(1000, nrow(df_num)))

pairs(df_num[idx, ],
      pch = 16, cex = 0.4,
      main = "Pairs: variables numéricas (muestra)")

```

```{r}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor = 1.2, ...) {
  oldusr <- par("usr")
  on.exit(par(usr = oldusr))     # <- así NO da warnings
  par(usr = c(0, 1, 0, 1))

  r <- suppressWarnings(cor(x, y, method = "spearman"))
  txt <- formatC(r, digits = digits, format = "f")
  text(0.5, 0.5, paste0(prefix, txt), cex = cex.cor)
}

pairs(df_num[idx, ],
      lower.panel = panel.smooth,
      upper.panel = panel.cor,
      pch = 16, cex = 0.4,
      main = "Pairs + Spearman")


```

En el gráfico Pairs + Spearman se aprecia, en primer lugar, que las variables de tamaño (alto, ancho y area) están fuertemente relacionadas entre sí. Natural; las obras con mayor altura tienden a tener mayor anchura, y el area al ser un producto de ambas concentra prácticamente la misma información. En términos de análisis esta “familia” de variables es redundante: si en fases posteriores se construyen modelos, conviene evitar incluir a la vez alto, ancho y area porque pueden introducir colinealidad (aportan información muy parecida).

En los paneles de dispersión se ve que razon no aumenta sistemáticamente con alto, ancho o area: hay obras grandes y pequeñas con proporciones similares. Esto es importante porque sugiere que la proporción del cuadro es relativamente independiente del tamaño; por tanto.

La relación entre razon y dist_phi_log muestra un patrón claramente no lineal esperable porque dist_phi_log es la distancia a la razón áurea: toma valores pequeños cuando razon está cerca de φ y crece cuando se aleja por encima o por debajo. 

Por último, fecha_est no presenta asociaciones fuertes y lineales con las dimensiones ni con las medidas de proporción en esta exploración global, si existe algún efecto temporal, probablemente débil o  condicionado por subgrupos más que por el año en sí. 

```{r}

# numéricas (incluye 0/1)
df_num_all <- df[, sapply(df, is.numeric), drop = FALSE]

# si no quieres incluir la respuesta en esta exploración:
df_num_all$exito <- NULL

cor_mat <- cor(df_num_all, method = "spearman")
round(cor_mat, 2)[1:10, 1:10]  # vistazo

# (opcional) visualizar
image(cor_mat, axes = FALSE, main = "Correlaciones Spearman")
axis(1, at = seq(0, 1, length.out = ncol(cor_mat)), labels = colnames(cor_mat), las = 2, cex.axis = 0.6)
axis(2, at = seq(0, 1, length.out = ncol(cor_mat)), labels = rownames(cor_mat), las = 2, cex.axis = 0.6)

```
Este mapa de calor resume las correlaciones de Spearman entre las variables numéricas (incluidas las dummies 0/1). Sirve para ver qué variables se mueven juntas y cuáles aportan información más independiente. Al ser Spearman (por rangos), es útil aunque haya asimetrías, outliers o relaciones no perfectamente lineales.

Lo más evidente es el bloque de correlaciones altas entre alto, ancho y area. 7

También se aprecia que las variables ligadas a la proporción áurea (por ejemplo `razon` y `dist_phi_log`) presentan una relación destacable entre sí, lo cual tiene sentido porque **`dist_phi_log` se deriva directamente de `razon`** como medida de “distancia” a φ. Por tanto, no deben interpretarse como dos fuentes independientes de información: si el objetivo es modelar o explicar “cercanía a la proporción áurea”, normalmente conviene trabajar **o bien con `razon` o bien con `dist_phi_log`**, según si queréis una medida directa de proporción o una medida de desviación respecto a φ.

En contraste, el resto de variables (por ejemplo `fecha_est`, `serie`, `sop_montaje` y las dummies `tec_*`) muestran, en general, **correlaciones relativamente bajas** con el bloque de tamaño y con las variables de proporción, lo que sugiere que aportan información distinta y que sus efectos, si existen, probablemente no se explican simplemente por “cuadros más grandes/pequeños” o por el periodo. Dentro del grupo `tec_*` pueden aparecer correlaciones negativas entre algunas técnicas, algo normal porque en la práctica muchas técnicas funcionan como **alternativas** (si predomina una, disminuye la presencia de otra), aunque en vuestro caso puede haber multietiqueta.

En resumen, este gráfico confirma dos decisiones metodológicas importantes: (1) **reducir redundancia** quedándonos con una sola variable de tamaño y evitando meter juntas variables derivadas entre sí; y (2) separar el análisis de “tamaño” del análisis de “proporción”, porque no parecen ser la misma dimensión del fenómeno. Esto deja el terreno preparado para comparar `exito` con variables interpretables (técnica, soporte, época, etc.) sin que los resultados estén dominados por dependencias matemáticas entre variables.

##totas vairables con la variable respuesta exito

#que variables influyen al exito , hay diferencias entre categorias

## exito y area 
```{r}
boxplot(log1p(df$area) ~ df$exito,
        main = "Distribución de log(área+1) según cumplimiento de la condición áurea",
        xlab = "¿Cumple la condición áurea?",
        ylab = "log(área + 1)",
        las = 1)

df$exito_f <- factor(df$exito, levels = c(0, 1),
                     labels = c("No cumple", "Sí cumple"))

```

Se observan outliers de obras muy pequeñas y muy grandes en ambos grupos, pero al usar log(área+1) su efecto queda controlado; no conviene eliminarlos, solo revisar los casos más extremos por si hay medidas atípicas.
La mediana de log(área+1) es algo mayor en el grupo que sí cumple (1) que en el que no cumple (0), aunque hay bastante solapamiento, por lo que el tamaño parece asociarse al éxito de forma leve.

# fecha estimada y exito 
```{r}
boxplot((df$fecha_est) ~ df$exito,
        main = "Distribución de la fecha estimada según cumplimiento de la condición áurea",
        xlab = "¿Cumple la condición áurea?",
        ylab = "fecha estimada",
        las = 1)


tab <- table(df$tam_cat, df$exito)
prop <- prop.table(tab, 1)  # proporciones por fila (cada tam_cat suma 1)

```
Se observan outliers de fechas muy tempranas en ambos grupos (más visibles en el grupo 0), que conviene revisar como posibles estimaciones poco precisas o casos especiales, pero no eliminarlos sin justificación histórica.
La distribución del grupo que sí cumple (1) aparece ligeramente desplazada a fechas más recientes (mediana más alta), aunque hay solapamiento, por lo que la fecha podría influir de forma débil en el éxito.

## tamaño categorizado con exito  

```{r}
barplot(t(prop),
        beside = FALSE,
        ylim = c(0,1),
        main = "Distribución de exito dentro de cada tam_cat",
        xlab = "tam_cat",
        ylab = "Proporción",
        las = 1)
legend("topright", legend = colnames(prop), bty = "n")
```
Se aprecia que la proporción de “sí cumple” es menor en obras grandes y mayor en medianas/pequeñas, lo que sugiere que el tamaño categorizado podría influir en el éxito (aunque las diferencias no parecen enormes).

# fecha estimada con exito 
```{r}
hist(df$fecha_est, breaks="FD", main="Distribución de fecha_est", xlab="año estimado")

# tamaño a lo largo del tiempo (con suavizado)
plot(df$fecha_est, log1p(df$area), pch=16, cex=0.3,
     xlab="fecha_est", ylab="log1p(area)",
     main="Tamaño (log) vs tiempo")
lines(lowess(df$fecha_est, log1p(df$area), f=0.3), lwd=2)

```

##orientación con exito 
```{r}
tab <- table(df$orientacion, df$exito_f)

cols <- c("red", "green")  # No cumple / Sí cumple

barplot(t(tab),
        beside = TRUE,
        col = cols,
        las = 1,
        main = "Éxito según orientación",
        xlab = "Orientación",
        ylab = "Número de obras")

legend("topleft",
       legend = colnames(tab),
       fill = cols,
       bty = "n",
       cex = 0.9)

```
La categoría “cuadrado” tiene muy pocas observaciones y no es fiable para concluir.
Entre horizontal y vertical se ve una diferencia pequeña: ambas concentran la mayoría de casos y la proporción de “sí cumple” parece similar, por lo que la orientación por sí sola no parece influir mucho en el éxito.

## soporte con exito 
```{r}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
tab <- table(df$soporte_grp, df$exito_f)

rate <- tab[, "Sí cumple"] / rowSums(tab)
n <- rowSums(tab)

ord <- order(rate, decreasing=TRUE)
rate <- rate[ord]; n <- n[ord]

ylab2 <- names(rate)
ylab2 <- gsub("Papel/Vitela", "Papel/\nVitela", ylab2)
ylab2 <- gsub("Tabla/Panel", "Tabla/\nPanel", ylab2)

op <- par(no.readonly=TRUE)

par(mar=c(5, 11, 4, 2) + 0.1)   # margen izq razonable
xmax <- max(rate) * 1.35        # escala que se adapte a tus tasas
bp <- barplot(rate,
              horiz=TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col="lightblue",
              las=1,
              cex.names=0.95,
              main="Tasa de cumplimiento áureo por soporte",
              xlab="P(Sí cumple)",
              ylab="")

# "Soporte" cerca, sin exagerar
mtext("Soporte", side=2, line=3)

text(x=rate, y=bp, labels=paste0("  n=", n), pos=4, cex=0.9)

par(op)


```
Se observan diferencias en la tasa de éxito por soporte: lienzo, mural y tabla/panel presentan tasas más altas, mientras que metal y “otros” muestran tasas más bajas, lo que sugiere que el soporte podría influir en el éxito.
Aun así, varias categorías tienen n pequeño (p. ej., mural, papel/vitela, otros), por lo que esas diferencias deben interpretarse con cautela y confirmarse con un contraste/modelo.

## soporte montaje con exito 

```{r}
# Etiquetas bonitas
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple", "Sí cumple"))
df$sop_montaje_f <- factor(df$sop_montaje, levels = c(0,1),
                           labels = c("No montaje", "Sí montaje"))

tab <- table(df$sop_montaje_f, df$exito_f)

cols <- c("red", "green")  # No / Sí

barplot(t(tab),
        beside = TRUE,
        col = cols,
        las = 1,
        main = "Éxito según sop_montaje",
        xlab = "sop_montaje",
        ylab = "Número de obras")

legend("topright",
       legend = colnames(tab),
       fill = cols,
       bty = "n")

rate <- tab[, "Sí cumple"] / rowSums(tab)

barplot(rate,
        ylim = c(0,1),
        col = "lightblue",
        las = 1,
        main = "Tasa de cumplimiento áureo según sop_montaje",
        xlab = "sop_montaje",
        ylab = "P(Sí cumple)")

text(seq_along(rate), rate, labels = round(rate, 3), pos = 3)

tab
round(prop.table(tab, 1), 3)  # proporciones por fila

```
La variable sop_montaje parece influir un poco: cuando la obra es “montaje”, el porcentaje que cumple la proporción áurea es 14.1%, y cuando no es montaje es 12.0% (o sea, en montaje se cumple algo más).
La diferencia es pequeña y además hay muchísimas menos obras con montaje (276) que sin montaje (6759), así que no podemos asegurar que sea una diferencia “real” sin comprobarlo con un test/modelo.

```{r}
# Etiquetas de exito
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

# Serie como factor (con labels bonitos)
df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))

# Tabla serie x éxito
tab <- table(df$serie_f, df$exito_f)

# Proporciones dentro de cada serie (cada fila suma 1)
prop <- prop.table(tab, 1)

# Ordenar por tasa de "Sí cumple" (opcional)
rate <- prop[, "Sí cumple"]
ord <- order(rate, decreasing = TRUE)
prop <- prop[ord, , drop = FALSE]
n <- rowSums(tab)[ord]

# Colores fijos
cols <- c("red", "green")  # No cumple / Sí cumple

par(mar=c(8,4,4,2)+0.1)
bp <- barplot(t(prop),
              beside = FALSE,
              ylim = c(0,1),
              las = 2,
              col = cols,
              main = "Distribución de éxito dentro de cada grupo de serie",
              ylab = "Proporción",
              xlab = "Serie")

legend("topright",
       legend = c("No cumple","Sí cumple"),
       fill = cols,
       bty = "n")

# n encima de cada barra
text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

# (Opcional) mirar tabla y proporciones
tab
round(prop, 3)

```

## tipo de autor con exito 
```{r}
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

tab <- table(df$tipo_autor, df$exito_f)
rate <- tab[, "Sí cumple"] / rowSums(tab)

barplot(rate, ylim=c(0,1), las=1, col="lightblue",
        main="Tasa de cumplimiento áureo por tipo de autor",
        ylab="P(Sí cumple)")
text(seq_along(rate), rate, labels=round(rate,3), pos=3, cex=0.8)

```
Se observan diferencias en la tasa de éxito según tipo de autor (más alta en “varios” y “mujer”, más baja en “anónimo”), lo que sugiere cierta asociación entre tipo de autor y cumplimiento áureo.
Pero hay que tener en cuenta el tamaño muestral muy desigual (hombre n=6161 vs mujer n=59 y varios n=154): las tasas de “mujer” y “varios” son mucho menos estables y deben interpretarse con cautela.

## si forma parte de una serie y exito
```{r}
# Etiquetas
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))

tab <- table(df$serie_f, df$exito_f)
cols <- c("red", "green")  # No cumple / Sí cumple

# 1) UNA barra por etiqueta (apilada) con CONTEOS
barplot(tab,
        beside = FALSE,
        col = cols,
        las = 1,
        main = "Éxito según pertenencia a serie",
        xlab = "Serie",
        ylab = "Número de obras")

legend("topright",
       legend = colnames(tab),
       fill = cols,
       bty = "n")

tab
round(prop.table(tab, 1), 3)   # proporciones dentro de cada grupo de serie

```
Pertenecer a una serie parece estar asociado a un ligero aumento del éxito: las obras en serie cumplen un poco más (13.7%) que las que no pertenecen a serie (11.7%).
La diferencia es pequeña pero consistente, y como ambos grupos tienen tamaños razonables (n=1407 en serie vs n=5628 fuera), es un patrón a tener en cuenta y que se puede confirmar con un test/modelo.

## fecha estimada y exito 
```{r}
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

boxplot(df$fecha_est ~ df$exito_f,
        main = "Fecha estimada según cumplimiento áureo",
        xlab = "¿Cumple?",
        ylab = "fecha_est (año)",
        las = 1)

```
Las obras que sí cumplen la condición áurea tienden a ser ligeramente más recientes (mediana algo más alta) que las que no cumplen, por lo que la fecha estimada podría estar asociada al éxito, aunque el solapamiento entre cajas es grande.
Los outliers son pocas obras muy antiguas (sobre todo en “no cumple”); no se eliminarían por defecto, pero conviene revisarlas por si son fechas mal estimadas o casos especiales, y usar métodos robustos si afectan al modelo.

## tema y exito 

```{r}
# Etiquetas bonitas para exito
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

# Tabla tema × exito
tab <- table(df$tema, df$exito_f)

# Tasa de éxito por tema
rate <- tab[, "Sí cumple"] / rowSums(tab)
n <- rowSums(tab)

# Ordenar (elige UNA de estas dos)
ord <- order(rate, decreasing = TRUE)   # por tasa de éxito
# ord <- order(n, decreasing = TRUE)    # por tamaño muestral

rate <- rate[ord]
n <- n[ord]

# Línea base (tasa global)
p_global <- mean(df$exito_f == "Sí cumple")

# Plot horizontal para que se lean todos los temas
par(mar = c(5, 16, 4, 2) + 0.1)

bp <- barplot(rate,
              horiz = TRUE,
              xlim = c(0, 1),
              col = "lightblue",
              las = 1,
              main = "Tasa de cumplimiento áureo por tema",
              xlab = "P(Sí cumple)")

abline(v = p_global, lty = 2)

# Etiquetas con n
text(x = rate, y = bp, labels = paste0("n=", n), pos = 4, cex = 0.8)

par(mar = c(5,4,4,2) + 0.1)

```
Si la barra de un tema queda a la derecha de esa línea → ese tema tiene una tasa de éxito mayor que la media general.
Si queda a la izquierda → menor que la media general.
Se aprecian diferencias de tasa de éxito entre temas (algunas categorías quedan por encima y otras por debajo de la media general), lo que sugiere que el “tema” podría estar relacionado con el cumplimiento áureo.
Pero hay que interpretar con mucha cautela los temas con n pequeño (p. ej., caza_animales n=106 o proceso_obra n=123), porque sus porcentajes pueden variar mucho por azar; las comparaciones más fiables son las de temas con n grande (p. ej., religioso n=2512, otros n=1216, retrato_corte n=995).

#SEGUIMOOOSOOSOSOSOOSOOSOSOO


##orientación con tam_cat
```{r}
# ORIENTACION vs TAM_CAT  (barras 100% por tamaño)
tab <- table(df$orientacion, df$tam_cat)
tab  # conteos

prop_col <- prop.table(tab, 2)  # proporciones dentro de cada tam_cat
round(prop_col, 3)

cols <- c("skyblue3","orange2","gray50")  # vertical / horizontal / cuadrado (ajusta si quieres)

barplot(prop_col,
        beside = FALSE,
        ylim = c(0, 1),
        las = 1,
        col = cols,
        main = "Orientación dentro de cada tamaño (tam_cat)",
        xlab = "Tamaño (tam_cat)",
        ylab = "Proporción")

legend("topright", legend = rownames(prop_col), fill = cols, bty = "n")

```
En los tres tamaños (pequeño, mediano y grande) prácticamente no aparecen obras “cuadrado” (proporción casi 0), así que la orientación dominante es horizontal/vertical.

Sí hay diferencias entre categorías: en “mediano” aumenta la proporción de verticales (y bajan las horizontales) respecto a “grande” y “pequeño”, pero las diferencias no parecen enormes (el patrón general se mantiene).

## orientación con tam_cat i con exito 
```{r}
# Factores bonitos
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

# Asegura orden (opcional)
df$tam_cat <- factor(df$tam_cat, levels=c("pequeno","mediano","grande"))
df$orientacion <- factor(df$orientacion, levels=c("horizontal","vertical","cuadrado"))

# Tabla 3D: orientacion x tam_cat x exito
tab3 <- table(df$orientacion, df$tam_cat, df$exito_f)

# Colores fijos para éxito
cols_ex <- c("red","green")  # No cumple / Sí cumple

op <- par(no.readonly = TRUE)
par(mfrow=c(1,3), mar=c(7,4,4,1)+0.1)  # 3 paneles

for(tam in levels(df$tam_cat)){

  tab_tam <- tab3[, tam, ]               # orientacion x exito
  prop_tam <- prop.table(tab_tam, 1)     # dentro de cada orientacion suma 1

  bp <- barplot(t(prop_tam),
                beside=FALSE,
                ylim=c(0,1),
                las=2,
                col=cols_ex,
                main=paste("tam_cat =", tam),
                ylab="Proporción",
                xlab="Orientación")

  # n por orientación (tamaño muestral)
  n <- rowSums(tab_tam)
  text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)
}

legend("topright",
       legend=c("No cumple","Sí cumple"),
       fill=cols_ex, bty="n", inset=c(-0.15,0))

par(op)

```
En los tres tamaños (pequeño/mediano/grande) domina claramente el “No cumple” (rojo): las tasas de “Sí cumple” (verde) son bajas en general, así que no parece que el tamaño por sí solo cambie mucho el éxito.

Dentro de cada tamaño, la orientación sí marca pequeñas diferencias: en “grande” la orientación vertical parece tener una proporción de “Sí cumple” algo mayor que horizontal, pero ojo con “cuadrado” porque tiene muy pocas observaciones (n muy pequeño) y esa barra no es fiable para comparar.

## serie y soporte_grp
```{r}
# Serie con etiquetas bonitas (si ya la tienes, puedes saltarte esto)
df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))

# Tabla: soporte (filas) x serie (columnas)
tab <- table(df$soporte_grp, df$serie_f)
tab  # conteos


par(mar=c(6,4,4,12)+0.1, xpd=NA)  # MÁS margen derecho + permitir dibujar fuera
bp <- barplot(prop,
              beside = FALSE,
              ylim = c(0,1),
              las = 1,
              col = cols,
              main = "Soporte dentro de cada grupo de serie",
              xlab = "Serie",
              ylab = "Proporción")

# n total por cada grupo de serie
n_serie <- colSums(tab)
text(x = bp, y = 1.02, labels = paste0("n=", n_serie), cex = 0.85)

# Leyenda a la derecha (no se corta)
legend("topright",
       inset = c(-0.35, 0),
       legend = rownames(prop),
       fill = cols,
       bty = "n",
       cex = 0.9)

```

##soporte grp serie y exito 
```{r}
# Factores bonitos
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$serie_f <- factor(df$serie, levels=c(0,1),
                     labels=c("No pertenece a serie","Pertenece a serie"))

# Tabla 3D: soporte x serie x exito
tab3 <- table(df$soporte_grp, df$serie_f, df$exito_f)

# Orden soportes por nº total (para que sea estable y legible)
tot_sop <- apply(tab3, 1, sum)
tab3 <- tab3[order(tot_sop, decreasing=TRUE), , , drop=FALSE]

# Etiquetas con saltos de línea
ylab2 <- rownames(tab3)
ylab2 <- gsub("Papel/Vitela", "Papel/\nVitela", ylab2)
ylab2 <- gsub("Tabla/Panel", "Tabla/\nPanel", ylab2)

cols <- c("red", "green")  # No cumple / Sí cumple

op <- par(no.readonly=TRUE)

# 3 columnas: panel izq, panel der, columna de leyenda
layout(matrix(c(1,2,3), nrow=1), widths=c(1,1,0.55))

for (s in levels(df$serie_f)) {

  tab_s <- tab3[, s, , drop=FALSE][,,1:2]   # soporte x exito
  tab_s <- tab_s[, c("No cumple","Sí cumple")]

  prop_s <- prop.table(tab_s, 1)           # cada soporte suma 1 (proporción dentro de soporte)
  prop_s[is.na(prop_s)] <- 0
  n <- rowSums(tab_s)

  par(mar=c(5, 9.5, 3.5, 2) + 0.1, xpd=NA)

  bp <- barplot(t(prop_s),
                horiz=TRUE,
                names.arg=ylab2,
                col=cols,
                xlim=c(0,1),
                las=1,
                cex.names=0.9,
                main=paste("Serie:\n", s),
                xlab="Proporción",
                border=NA)

  axis(1, at=seq(0,1,0.2))
  box()

  # n al final de cada barra (a la derecha)
  text(x=1.02, y=bp, labels=paste0("n=", n), pos=4, cex=0.8)
}

# Columna 3: leyenda limpia
par(mar=c(0,0,0,0))
plot.new()
legend("center",
       legend=c("No cumple","Sí cumple"),
       fill=cols,
       bty="n",
       cex=1)

par(op)

```

## serie i fecha estimada
```{r}
df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))

par(mar = c(6,6,4,2) + 0.1)

boxplot(fecha_est ~ serie_f, data = df,
        col = c("gray85","lightblue"),
        pch = 16, cex = 0.7,
        main = "Fecha estimada según pertenencia a serie",
        xlab = "Serie",
        ylab = "fecha_est (año)",
        las = 1)

# puntos con transparencia + muestra (para que se vea bien)
set.seed(1)
m <- min(800, nrow(df))
idx <- sample(seq_len(nrow(df)), m)

stripchart(df$fecha_est[idx] ~ df$serie_f[idx],
           vertical = TRUE, method = "jitter",
           pch = 16, cex = 0.35,
           col = adjustcolor("black", alpha.f = 0.25),
           add = TRUE)

grid(nx = NA, ny = NULL)

```

#fecha estimada serie y exito
```{r}
# Factores bonitos
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))

cols <- c("red", "green")  # No cumple / Sí cumple

op <- par(no.readonly = TRUE)

par(mfrow = c(1,2), mar = c(6,5,4,1) + 0.1, oma = c(0,0,2,0))

for (s in levels(df$serie_f)) {
  sub <- df[df$serie_f == s, , drop = FALSE]

  bp <- boxplot(fecha_est ~ exito_f, data = sub,
                col = cols,
                main = paste("Serie:", s),
                xlab = "Éxito",
                ylab = "fecha_est (año)",
                las = 1,
                outline = TRUE)

  grid(nx = NA, ny = NULL)

  # n encima de cada caja
  text(x = 1:2, y = par("usr")[4], labels = paste0("n=", bp$n),
       xpd = TRUE, pos = 3, cex = 0.85)
}

mtext("Fecha estimada por éxito, separando si pertenece a serie", outer = TRUE, cex = 1.1)

# leyenda (una sola vez)
legend("topleft", inset = 0.02,
       legend = levels(df$exito_f), fill = cols, bty = "n", cex = 0.9)

par(op)

```

## tema vs tecnica 
```{r}
tema <- factor(df$tema)
tec  <- factor(df$tecnica)  # niveles: oleo/mixta/otras (o los que tengas)

tab  <- table(tema, tec)
prop <- prop.table(tab, 1)        # cada tema suma 1
n_tema <- rowSums(tab)

# Ordenar temas por n (de mayor a menor)
ord <- order(n_tema, decreasing = TRUE)
prop <- prop[ord, , drop = FALSE]
n_tema <- n_tema[ord]

# Etiquetas más legibles
tema_lab <- rownames(prop)
tema_lab <- gsub("_", "\n", tema_lab)  # corta por guiones bajos

# Colores (uno por técnica)
cols <- rainbow(ncol(prop))
names(cols) <- colnames(prop)

op <- par(no.readonly = TRUE)

# 2 paneles: gráfico + leyenda (así NO se pisa nunca)
layout(matrix(c(1,2), 1, 2), widths = c(4.8, 1.6))

par(mar = c(5, 12, 4, 1) + 0.1, xpd = NA)
bp <- barplot(t(prop),
              horiz = TRUE,
              beside = FALSE,
              xlim = c(0, 1),
              las = 1,
              col = cols[colnames(prop)],
              names.arg = tema_lab,
              main = "Distribución de técnicas dentro de cada tema",
              xlab = "Proporción",
              ylab = "Tema",
              cex.names = 0.85)

# n al final de cada barra
text(x = 1.02, y = bp, labels = paste0("n=", n_tema), pos = 4, cex = 0.8)

# Panel de la leyenda
par(mar = c(0,0,0,0))
plot.new()
legend("center",
       legend = colnames(prop),
       fill = cols[colnames(prop)],
       bty = "n",
       cex = 1)

layout(1)
par(op)


# (opcional) tablas
tab
round(prop, 3)





```


## tema vs tecnica y exito 
```{r}
# ==== TEMA x TÉCNICA, separado por ÉXITO (2 paneles + leyenda aparte) ====

# (Opcional) para que se vea bien: abre ventana grande
dev.new(width = 13, height = 5)
# (Opcional alternativa) guardar bonito:
# png("tema_tecnica_exito.png", width=1800, height=700, res=140)

df$exito_f   <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tema_f    <- factor(df$tema)
df$tecnica_f <- factor(df$tecnica)

# tabla 3D: tema x técnica x éxito
tab3 <- with(df, table(tema_f, tecnica_f, exito_f))

# ordenar temas por N total (para que ambos paneles sean comparables)
tab_total <- apply(tab3, c(1,2), sum)
n_total   <- rowSums(tab_total)
ord <- order(n_total, decreasing = TRUE)

tab3 <- tab3[ord, , , drop=FALSE]
tema_levels <- dimnames(tab3)[[1]]

# etiquetas tema más legibles
tema_lab <- gsub("_", "\n", tema_levels)

# colores por técnica (automático, pero fijo)
cols <- rainbow(nlevels(df$tecnica_f))
names(cols) <- levels(df$tecnica_f)

# preparar proporciones dentro de cada tema, por panel de éxito
prop_list <- vector("list", length(levels(df$exito_f)))
n_list    <- vector("list", length(levels(df$exito_f)))

for (k in seq_along(levels(df$exito_f))) {
  tab_k <- tab3[,,k]
  n_k   <- rowSums(tab_k)
  prop_k <- prop.table(tab_k, 1)   # cada tema suma 1
  prop_k[is.na(prop_k)] <- 0
  prop_list[[k]] <- prop_k
  n_list[[k]] <- n_k
}

op <- par(no.readonly = TRUE)

# layout: panel1 | panel2 | leyenda
layout(matrix(c(1,2,3), 1, 3), widths = c(5.2, 5.2, 1.7))
par(oma=c(0,0,2,0))  # margen externo para título general

for (k in seq_along(levels(df$exito_f))) {

  # margen izq grande solo en el primer panel (para que se lean los temas)
  par(mar = c(4.5, ifelse(k==1, 12, 2), 3, 1) + 0.1, xpd = NA)

  bp <- barplot(t(prop_list[[k]]),
                horiz = TRUE,
                beside = FALSE,
                col = cols[colnames(prop_list[[k]])],
                xlim = c(0,1),
                las = 1,
                names.arg = if (k==1) tema_lab else rep("", length(tema_lab)),
                cex.names = 0.85,
                cex.axis = 0.9,
                main = paste("Éxito:", levels(df$exito_f)[k]),
                xlab = "Proporción",
                ylab = if (k==1) "Tema" else "")

  # n por tema (a la derecha)
  text(x = 1.02, y = bp, labels = paste0("n=", n_list[[k]]), pos = 4, cex = 0.75)
}

# panel leyenda (aparte)
par(mar=c(0,0,0,0))
plot.new()
legend("center",
       legend = levels(df$tecnica_f),
       fill = cols[levels(df$tecnica_f)],
       bty = "n",
       cex = 1)

mtext("Distribución de técnicas dentro de cada tema (separado por éxito)", outer=TRUE, cex=1.1)

layout(1)
par(op)

# if (dev.cur() != 1) dev.off()  # <-- descomenta si usaste png()

```

##area vs fecha
```{r}
plot(df$fecha_est, log(df$area),
     pch=16, cex=0.5,
     xlab="fecha_est", ylab="log(area)",
     main="Área vs fecha_est")
lines(lowess(df$fecha_est, log(df$area)), lwd=2)

```
La línea LOWESS es la tendencia: como está casi plana (ligeramente hacia abajo), no parece que el área cambie mucho con la fecha (relación débil o casi nula). Las “rayas verticales” salen porque muchos años se repiten.

```{r}
# Asegura exito como factor con etiquetas
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

# Colores por exito
col_ex <- ifelse(df$exito_f == "Sí cumple", "green3", "red3")

# Scatter (con jitter suave en X para que no se monten tanto)
x <- jitter(df$fecha_est, amount = 0.25)
y <- log(df$area)

plot(x, y,
     pch = 16, cex = 0.5,
     col = col_ex,
     xlab = "fecha_est",
     ylab = "log(area+1)",
     main = "Área vs fecha_est (coloreado por éxito)")

legend("topright",
       legend = c("No cumple","Sí cumple"),
       col = c("red3","green3"),
       pch = 16, bty = "n")

# Tendencia global
lines(lowess(df$fecha_est, y), lwd = 2)

# (Opcional) 2 tendencias: una por cada exito
lines(lowess(df$fecha_est[df$exito_f=="No cumple"], y[df$exito_f=="No cumple"]), lwd=2, col="red3")
lines(lowess(df$fecha_est[df$exito_f=="Sí cumple"], y[df$exito_f=="Sí cumple"]), lwd=2, col="green3")

```
En el gráfico, cada punto es una obra: el eje X es la fecha estimada y el eje Y es el tamaño (área) en escala logarítmica; los puntos verdes son las obras que sí cumplen y los rojos las que no cumplen. La idea es ver si “cumplir” se asocia a obras más grandes o a ciertas épocas, pero como las nubes de puntos se mezclan mucho y las líneas de tendencia (verde y roja) van muy parecidas, no se ve una diferencia clara: a lo sumo, la línea verde queda un pelín por encima en algunos tramos, lo que sugeriría que las que “sí cumplen” podrían ser ligeramente más grandes, pero la diferencia es pequeña y no parece que con fecha + área puedas predecir bien el éxito.

##area por categorías (tam_cat / orientacion / soporte / tecnica)
Para ver diferencias claras de tamaño (y outliers) por grupo.
```{r}


boxplot(log(df$area+1) ~ df$orientacion, las=2,
        main="log(area+1) por orientación", xlab="orientación", ylab="log(area+1)")

boxplot(log(df$area+1) ~ df$soporte_grp, las=2,
        main="log(area+1) por soporte", xlab="soporte", ylab="log(area+1)")

```
En el boxplot de log(area+1) por orientación, lo que se ve es que las diferencias entre “horizontal”, “vertical” y “cuadrado” no son enormes: las medianas están bastante parecidas y las cajas se solapan mucho. Aun así, parece que las horizontales tienden a tener un área “típica” un pelín más alta (la línea del medio está algo más arriba) y en vertical aparecen más valores muy pequeños (puntitos bajos), o sea, hay más cuadros verticales con áreas muy pequeñas.

En el boxplot de log(area+1) por soporte, aquí sí se aprecian diferencias más claras entre categorías: “Mural” y “Lienzo” suelen tener áreas más grandes (la caja y la mediana están más arriba), mientras que “Metal” y “Otros” suelen ser más pequeños (medianas más bajas). “Tabla/Panel” queda en medio, y en casi todos los soportes hay algunos cuadros enormes (puntos altos), pero son pocos y por eso salen como “outliers”.

```{r}
# Etiquetas de éxito
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

# Nos quedamos solo con NO-cuadrados
df2 <- subset(df, orientacion != "cuadrado" & !is.na(area))

# Quitar niveles vacíos ("cuadrado" desaparece de verdad)
df2$orientacion <- droplevels(factor(df2$orientacion))
df2$exito_f      <- droplevels(df2$exito_f)

# Grupo = orientacion + exito (sin niveles vacíos)
grp <- interaction(df2$orientacion, df2$exito_f, sep="\n", drop=TRUE)

# Color por grupo (rojo = No cumple, verde = Sí cumple)
col_grp <- ifelse(grepl("No cumple", levels(grp)), "red", "green")

par(mar=c(9,4,4,2)+0.1)
boxplot(log(df2$area + 1) ~ grp,
        las=2,
        col=col_grp,
        main="log(area+1) por orientación y éxito (sin cuadrados)",
        ylab="log(area+1)",
        xlab="")

legend("topright", legend=c("No cumple","Sí cumple"), fill=c("red","green"), bty="n")



```

```{r}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

# ¿Cuántos "cuadrado" hay y cuántos de esos salen "Sí cumple"?
with(df, table(orientacion, exito_f))

# Mira las razones SOLO de los cuadrados que "sí cumplen"
idx <- df$orientacion == "cuadrado" & df$exito_f == "Sí cumple"
summary(df$razon[idx])
head(df$razon[idx], 20)

# Y mira cómo son las razones en TODOS los cuadrados
summary(df$razon[df$orientacion=="cuadrado"])

```
```{r}

# =========================
# 2) log(area) ~ soporte_grp + exito
# =========================
par(mar=c(9,5,4,2)+0.1)

k2 <- length(levels(df$soporte_grp))

boxplot(y ~ df$soporte_grp * df$exito_f,
        col  = rep(cols_ex, times = k2),
        xaxt = "n",
        las  = 1,
        main = "log(area) por soporte y éxito",
        ylab = "log(area)",
        xlab = "")

axis(1,
     at = seq(1.5, by = 2, length.out = k2),
     labels = levels(df$soporte_grp),
     las = 2)

abline(v = seq(2.5, by = 2, length.out = k2-1), col = "gray80", lty = 2)

legend("topright", legend = levels(df$exito_f), fill = cols_ex, bty = "n")

par(op)
```

