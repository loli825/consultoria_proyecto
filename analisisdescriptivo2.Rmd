---
title: "analisisdescriptivoord"
output:
  html_document: default
  pdf_document: default
date: "2026-01-13"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Marco teórico: qué es la razón áurea

La razón áurea (también llamada proporción áurea, sección áurea o phi) es una proporción numérica aproximada de 1,618. Se define cuando dividimos un segmento en dos partes de forma que la relación entre la parte mayor y la menor sea la misma que la relación entre el total y la parte mayor. Esa proporción aparece en geometría y se relaciona con la sucesión de Fibonacci, porque el cociente entre términos consecutivos de Fibonacci se aproxima a 1,618 a medida que los números crecen.

En arte y diseño, la razón áurea se ha popularizado como una regla de composición asociada a armonía visual. En el discurso histórico se vincula con tradiciones artísticas (especialmente desde el Renacimiento) y con la idea de que ciertas proporciones resultan equilibradas o agradables a la vista. Sin embargo, que algo se use como herramienta o que aparezca en ejemplos puntuales no implica que automáticamente que sea una regla universal ni que explique por sí sola la “belleza” o la preferencia estética. Precisamente por eso es interesante tratarlo como un problema empírico: medir, comparar y contrastar hipótesis con datos. 

La investigación psicológica y experimental sobre si preferimos la razón áurea ha dado resultados mixtos. Hay estudios experimentales donde se comparan versiones de una misma imagen/pintura ajustadas a distintas proporciones y se observa preferencia por la sección áurea en ciertos contextos y muestras, pero también hay trabajos que cuestionan que exista una preferencia automática o universal por esta proporción, especialmente cuando se usan pruebas implícitas y estímulos más variados.

Además una línea importante de literatura advierte que muchas afirmaciones populares sobre la razón áurea en arte se apoyan en selecciones de ejemplos o en mediciones discutibles y que cuando se analiza de manera sistemática (por ejemplo, proporciones de formato en pinturas), la proporción áurea no siempre aparece como la proporción dominante.

## Objectius de l’estudi

L’objectiu general d’aquest treball és construir un model explicatiu que ens ajudi a entendre quins factors estan associats al fet que una obra compleixi o no la proporció àuria. No busquem fer predicció “per encertar”, sinó explicar amb quines característiques de les obres (com l’època, la mida, l’orientació, la tècnica o el suport) és més probable trobar la proporció àuria i com aquestes característiques es relacionen entre elles.

Com a objectiu específic volem descriure si el compliment de la proporció àuria és un fenomen freqüent dins del conjunt d’obres analitzades i si aquest compliment es concentra en determinats contextos (per exemple, en certs períodes històrics o en certs formats). També volem avaluar si variables com el suport i la tècnica poden actuar com a condicionants materials de la composició i, per tant, modificar la relació entre la mida i l’èxit.

Finalment, com a objectiu interpretatiu, volem discutir fins a quin punt el fet que una obra estigui present en museus o catàlegs pot estar relacionat amb decisions estètiques i de composició com la proporció àuria. Tot i que el nostre conjunt de dades no mesura directament “bellesa” ni “qualitat artística”, sí que ens permet plantejar la pregunta de manera crítica: si la proporció àuria fos una regla compositiva molt general en l’art, hauríem d’observar patrons clars i consistents en les obres analitzades i si apareix de forma irregular o depèn fortament del context, això reforça la idea que la seva presència no és universal i que cal interpretar-la com una eina possible però no de manera determinant.


```{r, echo = F}
library(readr)
setwd("~/Desktop/consultoria_proyecto")
df <- read_csv("prado_variables.csv")

df$exito <- as.factor(df$exito)
df$tam_cat <- factor(
  df$tam_cat,
  levels = c("0", "1-10", "11-98", "99", "+100"),
  ordered = TRUE
)
df$orientacion <- as.factor(df$orientacion)
df$soporte_grp <-as.factor(df$soporte_grp)
df$sop_montaje <-as.factor(df$sop_montaje)
df$tecnica <- as.factor(df$tecnica)
df$tipo_autor <- as.factor(df$tipo_autor)
df$serie <- as.factor(df$serie)
df$fecha_est <- as.integer(df$fecha_est)
df$tema <- as.factor(df$tema)
```

Empezamos el análisis descriptivo construyendo para cada variable, una tabla de frecuencias y el gráfico de barras correspondiente, la forma más directa de entender cómo se reparte la información dentro del conjunto de datos. Antes de comparar con la variable respuesta (exito) o plantear cualquier modelo, necesitamos saber qué categorías aparecen, con qué peso y si existe algún patrón evidente en la composición de la muestra.

Como control de calidad permite detectar problemas típicos en datos obtenidos por web scraping, como etiquetas duplicadas, niveles inesperados o valores codificados de manera especial.

Las frecuencias son necesarias para interpretar correctamente lo que venga después. Si tenemos una categoría muy mayoritaria cualquier resultado puede estar condicionado por esa dominancia. Tener la proporción de cada nivel ayuda a contextualizar comparaciones; no es lo mismo observar un patrón en una categoría con miles de obras que en otra con muy pocas.

Las clases minoritarias aun que ess habitual que algunas categorías tengan pocas observaciones.Si tenemos demasiados niveles con baja frecuencia hacen que los gráficos sean ilegibles y no podamos extraer conclusiones.

En resumen, trabajar variable por variable es una etapa imprescindible porque permite verificar la coherencia de las variables, comprender la estructura real de los datos y anticipar problemas derivados de categorías raras. Esto asegura que las comparaciones posteriores con exito sean interpretables, estables y defendibles.


##EXITO
```{r, echo = F}
table(df$exito)
v <- "exito"
tab <- sort(table(df[[v]]), decreasing = TRUE)

names(tab)[names(tab) == "0"] <- "0 (no cumple)"
names(tab)[names(tab) == "1"] <- "1 (cumple)"
barplot(tab, las = 1, main = "¿Cumple la proporción áurea?", ylab = "frequencia")
```


##AREA
```{r, echo = F}
hist(df$area, breaks=40, main="Histograma de área", xlab="area")
hist(log(df$area ), breaks=40, main="Histograma de log(area)", xlab="log(area)")
boxplot(df$area, main="Boxplot área", ylab="area")
boxplot(log(df$area), main="Boxplot log(area)", ylab="log(area)")
```

La variable area esta muy sesgada a la derecha: la mayoría de obras tienen áreas pequeñas y hay pocas con áreas enormes (por eso el histograma “normal” queda aplastado y el boxplot de area sale con mil outliers).

Al hacer log(area) la distribución queda mucho más “normalita” (campana) y el boxplot se vuelve legible.

## AREA CON ÉXITO
```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

boxplot(log(df$area) ~ df$exito_f,
        col = c("red","green"),
        main = "Área (log(area)) según éxito",
        xlab = "Éxito",
        ylab = "log(area)",
        las = 1)


df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
x <- log(df$area )

op <- par(no.readonly=TRUE)
par(mfrow=c(1,2))

hist(x[df$exito_f=="No cumple"], breaks=40,
     main="No cumple", xlab="log(area)")
hist(x[df$exito_f=="Sí cumple"], breaks=40,
     main="Sí cumple", xlab="log(area)")

par(op)

df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

k <- 10  # 10 barras (puedes subir/bajar)
br <- quantile(df$area, probs = seq(0, 1, length.out = k + 1), na.rm = TRUE)

br <- unique(br)
df$area_bin <- cut(df$area, breaks = br, include.lowest = TRUE)



```


##TAM_CAT
```{r, echo = F}
table(df$tam_cat)
v <- "tam_cat"
tab <- sort(table(df[[v]]), decreasing = TRUE)

barplot(tab, las = 1, main = "Tamaño", ylab = "frequencia")
```

##TAM_CAT CON ÉXITO 


```{r, echo = F}
tab <- table(df$tam_cat, df$exito)

prop <- prop.table(tab, 1)

bp <- barplot(t(prop),           
              beside = FALSE,
              ylim = c(0, 1),
              ylab = "Proporción",
              xlab = "tam_cat",
              main = "tam_cat vs exito ",
              las = 2)

legend("topright",
       legend = rownames(t(prop)),
       bty = "n")

cum <- apply(t(prop), 2, cumsum)
mid <- cum - (t(prop) / 2)    

text(x = rep(bp, each = nrow(t(prop))),
     y = as.vector(mid),
     labels = sprintf("%.2f", as.vector(t(prop))),
     cex = 0.8)

```



##ORIENTACIÓN
```{r, echo = F}
table(df$orientacion)
v <- "orientacion"
tab <- sort(table(df[[v]]), decreasing = TRUE)

barplot(tab, las = 1, main = "Orientación", ylab = "frequencia")
```

##EXITO SEGÚN ORIENTACIÓN 
```{r, echo = F}
# Tabla orientación x éxito
tab <- table(df$orientacion, df$exito_f)

# Proporciones dentro de cada orientación (cada fila suma 1)
prop <- prop.table(tab, 1)

cols <- c("red", "green")  # No cumple / Sí cumple

par(mar=c(6,5,4,2)+0.1)
bp <- barplot(t(prop),
              beside = FALSE,      # apilado
              ylim = c(0,1),       # todas igual de altas (100%)
              col = cols,
              las = 1,
              main = "Éxito según orientación (proporciones)",
              xlab = "Orientación",
              ylab = "Proporción")

legend("topleft",
       legend = c("No cumple","Sí cumple"),
       fill = cols,
       bty = "n",
       cex = 0.9)

# (opcional) n encima de cada barra
n <- rowSums(tab)
text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

```



```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0, 1), labels = c("No cumple", "Sí cumple"))

tab <- table(df$orientacion, df$exito_f)

rate <- tab[, "Sí cumple"] / rowSums(tab)
n    <- rowSums(tab)

ord  <- order(rate, decreasing = TRUE)
rate <- rate[ord]
n    <- n[ord]

wrap_labels <- function(x, width = 18){
  sapply(x, function(s) paste(strwrap(s, width = width), collapse = "\n"))
}
ylab2 <- wrap_labels(names(rate), width = 18)

p_global <- mean(df$exito == 1)

max_chars <- max(nchar(gsub("\n", "", ylab2)))
left_mar  <- min(22, max(11, ceiling(max_chars/2) + 3))
cex_txt   <- if (length(rate) > 20) 0.65 else if (length(rate) > 12) 0.8 else 0.95

if (dev.cur() == 1) dev.new(width = 10, height = 6)

op <- par(no.readonly = TRUE)
par(mar = c(5, left_mar, 4, 2) + 0.1)

xmax <- max(rate) * 1.35
bp <- barplot(rate,
              horiz = TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col = "lightblue",
              las = 1,
              cex.names = cex_txt,
              main = "Tasa de cumplimiento áureo por orientación",
              xlab = "P(Sí cumple)",
              ylab = "")

mtext("Orientación", side = 2, line = left_mar - 2)

abline(v = p_global, lty = 2, lwd = 2)
text(x = rate, y = bp, labels = paste0("  n=", n), pos = 4, cex = 0.85)
text(x = p_global, y = max(bp) + 0.7, labels = "media", pos = 3, cex = 0.8)

par(op)

```


#SOPORTE_GRP
```{r, echo = F}
table(df$soporte_grp)
v <- "soporte_grp"
tab <- sort(table(df[[v]]), decreasing = TRUE)

barplot(tab, las = 1, main = "Soporte", ylab = "frequencia")
```

##SOPORTE_GRP CON EXITO 

```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

tab <- table(df$soporte_grp, df$exito_f)
rate <- tab[, "Sí cumple"] / rowSums(tab)
n <- rowSums(tab)
ord <- order(rate, decreasing=TRUE)
rate <- rate[ord]; n <- n[ord]
ylab2 <- names(rate)
ylab2 <- gsub("Papel/Vitela", "Papel/\nVitela", ylab2)
ylab2 <- gsub("Tabla/Panel", "Tabla/\nPanel", ylab2)


p_global <- mean(df$exito == 1)

op <- par(no.readonly=TRUE)
par(mar=c(5, 11, 4, 2) + 0.1)

xmax <- max(rate) * 1.35
bp <- barplot(rate,
              horiz=TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col="lightblue",
              las=1,
              cex.names=0.95,
              main="Tasa de cumplimiento áureo por soporte",
              xlab="P(Sí cumple)",
              ylab="")

mtext("Soporte", side=2, line=3)

abline(v = p_global, lty = 2, lwd = 2)
text(x=rate, y=bp, labels=paste0("  n=", n), pos=4, cex=0.9)%%
text(x=p_global, y=max(bp)+0.6, labels="media", pos=3, cex=0.8)

par(op)

```


```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

tab <- table(df$soporte_grp, df$exito_f)

# proporciones dentro de cada soporte (cada barra suma 1)
prop <- prop.table(tab, 1)

# ordenar por tasa de Sí cumple (opcional)
rate <- prop[, "Sí cumple"]
ord <- order(rate, decreasing=TRUE)
prop <- prop[ord, , drop=FALSE]
n <- rowSums(tab)[ord]

cols <- c("red", "green")  # No cumple / Sí cumple

op <- par(no.readonly=TRUE)
par(mar=c(10,4,4,2)+0.1)

bp <- barplot(t(prop),
              beside = FALSE,
              ylim = c(0,1),
              las = 2,
              col = cols,
              main = "Éxito dentro de cada soporte (barras 100%)",
              ylab = "Proporción",
              xlab = "Soporte")

legend("topright", legend = c("No cumple","Sí cumple"), fill = cols, bty = "n")

# n encima
text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

par(op)

```



##SOP_MONTAJE
```{r, echo = F}
table(df$sop_montaje)
v <- "sop_montaje"
tab <- sort(table(df[[v]]), decreasing = TRUE)

names(tab)[names(tab) == "0"] <- "0 (No es un montaje)"
names(tab)[names(tab) == "1"] <- "1 (Sí es un montaje)"

barplot(tab, las = 1, main = "Soportes", ylab = "frequencia")
```

## SOP_MONTAJE Y EXITO 
```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$sop_f <- factor(df$sop_montaje, levels=c(0,1), labels=c("No montaje","Sí montaje"))

tab <- table(df$sop_f, df$exito_f)
prop <- prop.table(tab, 1)
n <- rowSums(tab)

cols <- c("red","green")

par(mar=c(6,4,4,2)+0.1)
bp <- barplot(t(prop),
              beside = FALSE,
              ylim = c(0,1),
              col = cols,
              las = 1,
              main = "Éxito según sop_montaje (proporciones)",
              xlab = "sop_montaje",
              ylab = "Proporción")

legend("topright", legend = c("No cumple","Sí cumple"), fill = cols, bty = "n")
text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

tab
round(prop, 3)

```


```{r, echo = F}
df$exito_f <- factor(df$exito,
                     levels = c(0, 1),
                     labels = c("No cumple", "Sí cumple"))

tab <- table(df$sop_montaje, df$exito_f)

rate <- tab[, "Sí cumple"] / rowSums(tab)
n    <- rowSums(tab)

ord  <- order(rate, decreasing = TRUE)
rate <- rate[ord]
n    <- n[ord]

wrap_labels <- function(x, width = 18){
  sapply(x, function(s) paste(strwrap(s, width = width), collapse = "\n"))
}
ylab2 <- wrap_labels(names(rate), width = 18)


p_global <- mean(df$exito == 1)

max_chars <- max(nchar(gsub("\n", "", ylab2)))
left_mar  <- min(22, max(11, ceiling(max_chars / 2) + 3))
cex_txt   <- if (length(rate) > 20) 0.65 else if (length(rate) > 12) 0.8 else 0.95

if (dev.cur() == 1) dev.new(width = 10, height = 6)

op <- par(no.readonly = TRUE)
par(mar = c(5, left_mar, 4, 2) + 0.1)

xmax <- max(rate) * 1.35
bp <- barplot(rate,
              horiz = TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col = "lightblue",
              las = 1,
              cex.names = cex_txt,
              main = "Tasa de cumplimiento áureo por soporte de montaje",
              xlab = "P(Sí cumple)",
              ylab = "")

mtext("sop_montaje", side = 2, line = left_mar - 2)

abline(v = p_global, lty = 2, lwd = 2)
text(x = rate, y = bp, labels = paste0("  n=", n), pos = 4, cex = 0.85)
text(x = p_global, y = max(bp) + 0.7, labels = "media", pos = 3, cex = 0.8)

par(op)

```



##TECNICA
```{r, echo = F}

table(df$tecnica)
v <- "tecnica"
tab <- sort(table(df[[v]]), decreasing = TRUE)

barplot(tab, las = 1, main = "Tecnica", ylab = "frequencia")
```

## TECNICA CON EXITO 

```{r, echo = F}

df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tecnica_f <- factor(df$tecnica)

tab <- table(df$tecnica_f, df$exito_f)
prop <- prop.table(tab, 1)  
n <- rowSums(tab)

rate <- prop[, "Sí cumple"]
ord <- order(rate, decreasing=TRUE)
prop <- prop[ord, , drop=FALSE]
n <- n[ord]

cols <- c("red","green")

par(mar=c(10,4,4,2)+0.1)
bp <- barplot(t(prop),
              beside = FALSE,
              ylim = c(0,1),
              col = cols,
              las = 2,
              main = "Éxito según técnica (proporciones)",
              xlab = "Técnica",
              ylab = "Proporción")

legend("topright", legend=c("No cumple","Sí cumple"), fill=cols, bty="n")
text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

tab
round(prop, 3)

```

```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0, 1), labels = c("No cumple", "Sí cumple"))

tab <- table(df$tecnica, df$exito_f)

rate <- tab[, "Sí cumple"] / rowSums(tab)
n    <- rowSums(tab)

ord  <- order(rate, decreasing = TRUE)
rate <- rate[ord]
n    <- n[ord]

wrap_labels <- function(x, width = 18){
  sapply(x, function(s) paste(strwrap(s, width = width), collapse = "\n"))
}
ylab2 <- wrap_labels(names(rate), width = 18)

p_global <- mean(df$exito == 1)

max_chars <- max(nchar(gsub("\n", "", ylab2)))
left_mar  <- min(26, max(11, ceiling(max_chars/2) + 3))
cex_txt   <- if (length(rate) > 25) 0.55 else if (length(rate) > 18) 0.7 else if (length(rate) > 12) 0.8 else 0.95

if (dev.cur() == 1) dev.new(width = 11, height = 7)

op <- par(no.readonly = TRUE)
par(mar = c(5, left_mar, 4, 2) + 0.1)

xmax <- max(rate) * 1.35
bp <- barplot(rate,
              horiz = TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col = "lightblue",
              las = 1,
              cex.names = cex_txt,
              main = "Tasa de cumplimiento áureo por técnica",
              xlab = "P(Sí cumple)",
              ylab = "")

mtext("Técnica", side = 2, line = left_mar - 2)

abline(v = p_global, lty = 2, lwd = 2)
text(x = rate, y = bp, labels = paste0("  n=", n), pos = 4, cex = 0.85)
text(x = p_global, y = max(bp) + 0.7, labels = "media", pos = 3, cex = 0.8)

par(op)

```


##TIPO_AUTOR
```{r, echo = F}
table(df$tipo_autor)

v <- "tipo_autor"
tab <- sort(table(df[[v]]), decreasing = TRUE)

barplot(tab, las = 1, main = "Tipo de Autor", ylab = "frequencia")
```

## TIPO AUTOR CON EXITO 

```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)

tab <- table(df$tipo_autor_f, df$exito_f)
prop <- prop.table(tab, 1)   # proporciones dentro de cada tipo_autor
n <- rowSums(tab)

# ordenar por tasa de "Sí cumple" (opcional)
rate <- prop[, "Sí cumple"]
ord <- order(rate, decreasing=TRUE)
prop <- prop[ord, , drop=FALSE]
n <- n[ord]

cols <- c("red","green")

par(mar=c(9,4,4,2)+0.1)
bp <- barplot(t(prop),
              beside = FALSE,
              ylim = c(0,1),
              col = cols,
              las = 2,
              main = "Éxito según tipo de autor (proporciones)",
              xlab = "Tipo de autor",
              ylab = "Proporción")

legend("topright", legend=c("No cumple","Sí cumple"), fill=cols, bty="n")
text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

tab
round(prop, 3)

```

En todos los grupos (varios, mujer, hombre y anónimo) la mayoría de las obras no cumple la razón áurea, y la parte verde es siempre pequeña. Las proporciones de “sí cumple” son muy parecidas entre tipos de autor, sin un grupo que destaque claramente por cumplir mucho más que los demás. Esto sugiere que el éxito en cumplir la razón áurea no depende de quién sea el autor, sino que el incumplimiento es lo normal independientemente del tipo de autor.



```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0, 1), labels = c("No cumple", "Sí cumple"))

tab <- table(df$tipo_autor, df$exito_f)

rate <- tab[, "Sí cumple"] / rowSums(tab)
n    <- rowSums(tab)

ord  <- order(rate, decreasing = TRUE)
rate <- rate[ord]
n    <- n[ord]

wrap_labels <- function(x, width = 18){
  sapply(x, function(s) paste(strwrap(s, width = width), collapse = "\n"))
}
ylab2 <- wrap_labels(names(rate), width = 18)

p_global <- mean(df$exito == 1)

max_chars <- max(nchar(gsub("\n", "", ylab2)))
left_mar  <- min(26, max(11, ceiling(max_chars/2) + 3))
cex_txt   <- if (length(rate) > 25) 0.55 else if (length(rate) > 18) 0.7 else if (length(rate) > 12) 0.8 else 0.95

if (dev.cur() == 1) dev.new(width = 11, height = 7)

op <- par(no.readonly = TRUE)
par(mar = c(5, left_mar, 4, 2) + 0.1)

xmax <- max(rate) * 1.35
bp <- barplot(rate,
              horiz = TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col = "lightblue",
              las = 1,
              cex.names = cex_txt,
              main = "Tasa de cumplimiento áureo por tipo de autor",
              xlab = "P(Sí cumple)",
              ylab = "")

mtext("Tipo de autor", side = 2, line = left_mar - 2)

abline(v = p_global, lty = 2, lwd = 2)
text(x = rate, y = bp, labels = paste0("  n=", n), pos = 4, cex = 0.85)
text(x = p_global, y = max(bp) + 0.7, labels = "media", pos = 3, cex = 0.8)

par(op)

```


##SERIE 
```{r, echo = F}
table(df$serie)
v <- "serie"
tab <- sort(table(df[[v]]), decreasing = TRUE)
names(tab)[names(tab) == "0"] <- "0 (No)"
names(tab)[names(tab) == "1"] <- "1 (Sí)"

barplot(tab, las = 1, main = "Forma parte de una serie", ylab = "frequencia")
```

## SERIE CON EXITO 

```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

if (is.numeric(df$serie) || is.integer(df$serie)) {
  df$serie_f <- factor(df$serie, levels=c(0,1),
                       labels=c("No pertenece a serie","Pertenece a serie"))
} else {
  df$serie_f <- factor(df$serie)
}

tab <- table(df$serie_f, df$exito_f)
prop <- prop.table(tab, 1)   # proporciones dentro de cada grupo de serie
n <- rowSums(tab)

cols <- c("red","green")
par(mar=c(6,4,4,2)+0.1)
bp <- barplot(t(prop),
              beside = FALSE,
              ylim = c(0,1),
              col = cols,
              las = 1,
              main = "Éxito según pertenencia a serie (proporciones)",
              xlab = "Serie",
              ylab = "Proporción")

legend("topright", legend=c("No cumple","Sí cumple"), fill=cols, bty="n")
text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

tab
round(prop, 3)

```


```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0, 1), labels = c("No cumple", "Sí cumple"))

serie2 <- df$serie
if (is.numeric(serie2) || is.integer(serie2)) {
  serie2 <- factor(serie2, levels = c(0, 1), labels = c("0 (No)", "1 (Sí)"))
} else {
  serie2 <- as.factor(serie2)
}

tab <- table(serie2, df$exito_f)

rate <- tab[, "Sí cumple"] / rowSums(tab)
n    <- rowSums(tab)

ord  <- order(rate, decreasing = TRUE)
rate <- rate[ord]
n    <- n[ord]

wrap_labels <- function(x, width = 18){
  sapply(x, function(s) paste(strwrap(s, width = width), collapse = "\n"))
}
ylab2 <- wrap_labels(names(rate), width = 18)

p_global <- mean(df$exito == 1)

max_chars <- max(nchar(gsub("\n", "", ylab2)))
left_mar  <- min(22, max(11, ceiling(max_chars/2) + 3))
cex_txt   <- if (length(rate) > 20) 0.65 else if (length(rate) > 12) 0.8 else 0.95

if (dev.cur() == 1) dev.new(width = 10, height = 6)

op <- par(no.readonly = TRUE)
par(mar = c(5, left_mar, 4, 2) + 0.1)

xmax <- max(rate) * 1.35
bp <- barplot(rate,
              horiz = TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col = "lightblue",
              las = 1,
              cex.names = cex_txt,
              main = "Tasa de cumplimiento áureo por serie",
              xlab = "P(Sí cumple)",
              ylab = "")

mtext("Serie", side = 2, line = left_mar - 2)

abline(v = p_global, lty = 2, lwd = 2)
text(x = rate, y = bp, labels = paste0("  n=", n), pos = 4, cex = 0.85)
text(x = p_global, y = max(bp) + 0.7, labels = "media", pos = 3, cex = 0.8)

par(op)

```

##FECHA_ESTIMADA
```{r, echo = F}
x <- as.integer(df$fecha_est)
x <- x[is.finite(x)]

# breaks de 25
xmin <- floor(min(x)/25)*25
xmax <- ceiling(max(x)/25)*25
br <- seq(xmin, xmax + 25, by = 25)   # +25 para que no se quede corto

hist(x, breaks = br,
     main = "Fecha estimada (bins de 25 años)",
     xlab = "Año", ylab = "Frecuencia",
     right = FALSE)

```

## FECHA Y EXITO 
```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

x <- as.integer(df$fecha_est)
ok <- is.finite(x) & !is.na(df$exito_f)
x <- x[ok]
ex <- df$exito_f[ok]

bin_w <- 50  
xmin <- floor(min(x)/bin_w)*bin_w
xmax <- ceiling(max(x)/bin_w)*bin_w
br <- seq(xmin, xmax + bin_w, by=bin_w)

bin <- cut(x, breaks=br, right=FALSE, include.lowest=TRUE)

tab <- table(ex, bin)
prop <- prop.table(tab, 2)

cols <- c("red","green")

op <- par(no.readonly=TRUE)
par(mar=c(7,4,4,2)+0.1)

bp <- barplot(prop,
              beside=FALSE,
              col=cols,
              ylim=c(0,1),
              las=1,
              names.arg = rep("", ncol(prop)),  # quita TODAS las etiquetas feas
              main=paste0("Éxito por fecha_est (bins ", bin_w, " años) - proporciones"),
              xlab="Intervalo (años)",
              ylab="Proporción")

k <- 8
idx <- unique(round(seq(1, ncol(prop), length.out = k)))
labs <- colnames(prop)[idx]
text(x = bp[idx], y = -0.06, labels = labs, srt = 45, adj = 1, xpd = TRUE, cex = 0.8)

legend("topright", legend=rownames(prop), fill=cols, bty="n")
par(op)

```


```{r, echo = F}
boxplot((df$fecha_est) ~ df$exito,
        main = "Distribución de la fecha estimada según cumplimiento de la condición áurea",
        xlab = "¿Cumple la condición áurea?",
        ylab = "fecha estimada",
        las = 1)
```

##FECHA_ANCHO
```{r, echo = F}
hist(df$fecha_ancho, breaks=40, main="Histograma de fecha_ancho", xlab="area")
```

##TEMA 
```{r, echo = F}
table(df$tema)

v <- "tema"
tab <- sort(table(df[[v]]), decreasing = TRUE)
barplot(tab, las = 2, main = "Tema de la Obra", ylab = "frequencia")
```

##TEMA CON EXITO 
```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

tab <- table(df$tema, df$exito_f)

prop <- prop.table(tab, 1)

cols <- c("red", "green")

op <- par(no.readonly = TRUE)

bp <- barplot(t(prop),
              beside = FALSE,
              col = cols,
              ylim = c(0,1),
              las = 2,
              main = "Éxito según tema (proporciones)",
              xlab = "Tema",
              ylab = "Proporción")

legend("topright",
       legend = c("No cumple", "Sí cumple"),
       fill = cols,
       bty = "n")

n <- rowSums(tab)
text(x = bp, y = 1.02, labels = paste0("n=", n),
     xpd = TRUE, cex = 0.8)

par(op)

```


```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0, 1), labels = c("No cumple", "Sí cumple"))

tab <- table(df$tema, df$exito_f)

rate <- tab[, "Sí cumple"] / rowSums(tab)
n    <- rowSums(tab)

ord  <- order(rate, decreasing = TRUE)
rate <- rate[ord]
n    <- n[ord]

wrap_labels <- function(x, width = 18){
  sapply(x, function(s) paste(strwrap(s, width = width), collapse = "\n"))
}
ylab2 <- wrap_labels(names(rate), width = 18)

p_global <- mean(df$exito == 1)

max_chars <- max(nchar(gsub("\n", "", ylab2)))
left_mar  <- min(30, max(11, ceiling(max_chars/2) + 3))
cex_txt   <- if (length(rate) > 30) 0.50 else if (length(rate) > 22) 0.65 else if (length(rate) > 15) 0.8 else 0.95

if (dev.cur() == 1) dev.new(width = 12, height = 8)

op <- par(no.readonly = TRUE)
par(mar = c(5, left_mar, 4, 2) + 0.1)

xmax <- max(rate) * 1.35
bp <- barplot(rate,
              horiz = TRUE,
              names.arg = ylab2,
              xlim = c(0, xmax),
              col = "lightblue",
              las = 1,
              cex.names = cex_txt,
              main = "Tasa de cumplimiento áureo por tema",
              xlab = "P(Sí cumple)",
              ylab = "")

mtext("Tema", side = 2, line = left_mar - 2)

abline(v = p_global, lty = 2, lwd = 2)
text(x = rate, y = bp, labels = paste0("  n=", n), pos = 4, cex = 0.85)
text(x = p_global, y = max(bp) + 0.7, labels = "media", pos = 3, cex = 0.8)

par(op)

```


## VARIABLES 2 A 2 

### orientación con tam_cat
```{r, echo = F}
tab <- table(df$orientacion, df$tam_cat)
prop_col <- prop.table(tab, 2)  # proporciones
round(prop_col, 3)

cols <- c("skyblue3","orange2","gray50")  # vertical / horizontal / cuadrado (ajusta si quieres)

barplot(prop_col,
        beside = FALSE,
        ylim = c(0, 1),
        las = 1,
        col = cols,
        main = "Orientación dentro de cada tamaño (tam_cat)",
        xlab = "Tamaño (tam_cat)",
        ylab = "Proporción")

legend("topright", legend = rownames(prop_col), fill = cols, bty = "n")
```

En los tres tamaños (pequeño, mediano y grande) prácticamente no aparecen obras “cuadrado” (proporción casi 0), así que la orientación dominante es horizontal/vertical.

Sí hay diferencias entre categorías: en “mediano” aumenta la proporción de verticales (y bajan las horizontales) respecto a “grande” y “pequeño”, pero las diferencias no parecen enormes (el patrón general se mantiene).


### orientación con tam_cat i con exito
```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("0 (No cumple)","1 (Sí cumple)"))
df$tam_cat <- factor(df$tam_cat, levels=c("pequeno","mediano","grande"))
df$orientacion <- factor(df$orientacion, levels=c("horizontal","vertical","cuadrado"))

tab3 <- table(df$orientacion, df$tam_cat, df$exito_f)

cols_ex <- c("red","green")
op <- par(no.readonly = TRUE)
par(mfrow=c(1,3), mar=c(7,4,4,2)+0.1)

for(tam in levels(df$tam_cat)){

  tab_tam <- tab3[, tam, , drop=FALSE]   # <- importante drop=FALSE aquí
  tab_tam <- tab_tam[, 1, ]              # ahora sí: matriz 2D (orientacion x exito)

  prop_tam <- prop.table(tab_tam, 1)

  bp <- barplot(t(prop_tam),
                beside=FALSE,
                ylim=c(0,1),
                las=2,
                col=cols_ex,
                main=paste("tam_cat =", tam),
                ylab="Proporción",
                xlab="Orientación")

  n <- rowSums(tab_tam)
  text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)
}

legend("topright",
       legend=c("No cumple","Sí cumple"),
       fill=cols_ex, bty="n")

par(op)

```


### serie y soporte_grp

```{r, echo = F}
df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))
tab <- table(df$soporte_grp, df$serie_f)
tab 
```

```{r, echo = F}

tab <- table(df$soporte_grp, df$serie)
prop <- prop.table(tab, 2)

cols <- rainbow(nrow(prop))  # o tus colores

op <- par(no.readonly=TRUE)
par(mar=c(6,4,4,12)+0.1, xpd=NA)

bp <- barplot(prop,
              beside = FALSE,
              ylim = c(0,1),
              las = 1,
              col = cols,
              main = "Soporte dentro de cada grupo de serie",
              xlab = "Serie",
              ylab = "Proporción")

# n total por cada grupo (cada barra)
n_serie <- colSums(tab)
text(x = bp, y = 1.02, labels = paste0("n=", n_serie), cex = 0.85)

legend("topright",
       inset = c(-0.35, 0),
       legend = rownames(prop),
       fill = cols,
       bty = "n",
       cex = 0.9)

par(op)

```

### soporte grp serie y exito
```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$serie_f <- factor(df$serie, levels=c(0,1),
                     labels=c("No pertenece a serie","Pertenece a serie"))

tab3 <- table(df$soporte_grp, df$serie_f, df$exito_f)

tot_sop <- apply(tab3, 1, sum)
tab3 <- tab3[order(tot_sop, decreasing=TRUE), , , drop=FALSE]

ylab2 <- rownames(tab3)
ylab2 <- gsub("Papel/Vitela", "Papel/\nVitela", ylab2)
ylab2 <- gsub("Tabla/Panel", "Tabla/\nPanel", ylab2)

cols <- c("red", "green") 

op <- par(no.readonly=TRUE)

layout(matrix(c(1,2,3), nrow=1), widths=c(1,1,0.55))

for (s in levels(df$serie_f)) {

  tab_s <- tab3[, s, , drop=FALSE][,,1:2]   
  tab_s <- tab_s[, c("No cumple","Sí cumple")]

  prop_s <- prop.table(tab_s, 1) 
  prop_s[is.na(prop_s)] <- 0
  n <- rowSums(tab_s)

  par(mar=c(5, 9.5, 3.5, 2) + 0.1, xpd=NA)

  bp <- barplot(t(prop_s),
                horiz=TRUE,
                names.arg=ylab2,
                col=cols,
                xlim=c(0,1),
                las=1,
                cex.names=0.9,
                main=paste("Serie:\n", s),
                xlab="Proporción",
                border=NA)

  axis(1, at=seq(0,1,0.2))
  box()

  text(x=1.02, y=bp, labels=paste0("n=", n), pos=4, cex=0.8)
}

par(mar=c(0,0,0,0))
plot.new()
legend("center",
       legend=c("No cumple","Sí cumple"),
       fill=cols,
       bty="n",
       cex=1)
```


### serie i fecha estimada

```{r, echo = F}
df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))

par(mar = c(6,6,4,2) + 0.1)

boxplot(fecha_est ~ serie_f, data = df,
        col = c("gray85","lightblue"),
        pch = 16, cex = 0.7,
        main = "Fecha estimada según pertenencia a serie",
        xlab = "Serie",
        ylab = "fecha_est (año)",
        las = 1)

# puntos con transparencia + muestra (para que se vea bien)
set.seed(1)
m <- min(800, nrow(df))
idx <- sample(seq_len(nrow(df)), m)

stripchart(df$fecha_est[idx] ~ df$serie_f[idx],
           vertical = TRUE, method = "jitter",
           pch = 16, cex = 0.35,
           col = adjustcolor("black", alpha.f = 0.25),
           add = TRUE)

grid(nx = NA, ny = NULL)
```

### fecha estimada serie y exito

```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0,1),
                     labels = c("No cumple","Sí cumple"))

df$serie_f <- factor(df$serie, levels = c(0,1),
                     labels = c("No pertenece a serie", "Pertenece a serie"))

cols <- c("red", "green")  # No cumple / Sí cumple

op <- par(no.readonly = TRUE)

par(mfrow = c(1,2), mar = c(6,5,4,1) + 0.1, oma = c(0,0,2,0))

for (s in levels(df$serie_f)) {
  sub <- df[df$serie_f == s, , drop = FALSE]

  bp <- boxplot(fecha_est ~ exito_f, data = sub,
                col = cols,
                main = paste("Serie:", s),
                xlab = "Éxito",
                ylab = "fecha_est (año)",
                las = 1,
                outline = TRUE)

  grid(nx = NA, ny = NULL)

  # n encima de cada caja
  text(x = 1:2, y = par("usr")[4], labels = paste0("n=", bp$n),
       xpd = TRUE, pos = 3, cex = 0.85)
}

mtext("Fecha estimada por éxito, separando si pertenece a serie", outer = TRUE, cex = 1.1)

legend("topleft", inset = 0.02,
       legend = levels(df$exito_f), fill = cols, bty = "n", cex = 0.9)
```


### tema vs tecnica

```{r, echo = F}
tema <- factor(df$tema)
tec  <- factor(df$tecnica) 

tab  <- table(tema, tec)
prop <- prop.table(tab, 1) 
n_tema <- rowSums(tab)

ord <- order(n_tema, decreasing = TRUE)
prop <- prop[ord, , drop = FALSE]
n_tema <- n_tema[ord]

tema_lab <- rownames(prop)
tema_lab <- gsub("_", "\n", tema_lab)  # corta por guiones bajos

cols <- rainbow(ncol(prop))
names(cols) <- colnames(prop)

op <- par(no.readonly = TRUE)

layout(matrix(c(1,2), 1, 2), widths = c(4.8, 1.6))

par(mar = c(5, 12, 4, 1) + 0.1, xpd = NA)
bp <- barplot(t(prop),
              horiz = TRUE,
              beside = FALSE,
              xlim = c(0, 1),
              las = 1,
              col = cols[colnames(prop)],
              names.arg = tema_lab,
              main = "Distribución de técnicas dentro de cada tema",
              xlab = "Proporción",
              ylab = "Tema",
              cex.names = 0.85)

text(x = 1.02, y = bp, labels = paste0("n=", n_tema), pos = 4, cex = 0.8)

par(mar = c(0,0,0,0))
plot.new()
legend("center",
       legend = colnames(prop),
       fill = cols[colnames(prop)],
       bty = "n",
       cex = 1)

layout(1)
par(op)

tab
round(prop, 3)
```


### tema vs tecnica y exito

```{r, echo = F}
dev.new(width = 13, height = 5)

df$exito_f   <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tema_f    <- factor(df$tema)
df$tecnica_f <- factor(df$tecnica)

tab3 <- with(df, table(tema_f, tecnica_f, exito_f))

tab_total <- apply(tab3, c(1,2), sum)
n_total   <- rowSums(tab_total)
ord <- order(n_total, decreasing = TRUE)

tab3 <- tab3[ord, , , drop=FALSE]
tema_levels <- dimnames(tab3)[[1]]

tema_lab <- gsub("_", "\n", tema_levels)

cols <- rainbow(nlevels(df$tecnica_f))
names(cols) <- levels(df$tecnica_f)

prop_list <- vector("list", length(levels(df$exito_f)))
n_list    <- vector("list", length(levels(df$exito_f)))

for (k in seq_along(levels(df$exito_f))) {
  tab_k <- tab3[,,k]
  n_k   <- rowSums(tab_k)
  prop_k <- prop.table(tab_k, 1)   # cada tema suma 1
  prop_k[is.na(prop_k)] <- 0
  prop_list[[k]] <- prop_k
  n_list[[k]] <- n_k
}

op <- par(no.readonly = TRUE)

layout(matrix(c(1,2,3), 1, 3), widths = c(5.2, 5.2, 1.7))
par(oma=c(0,0,2,0)) 

for (k in seq_along(levels(df$exito_f))) {

  par(mar = c(4.5, ifelse(k==1, 12, 2), 3, 1) + 0.1, xpd = NA)

  bp <- barplot(t(prop_list[[k]]),
                horiz = TRUE,
                beside = FALSE,
                col = cols[colnames(prop_list[[k]])],
                xlim = c(0,1),
                las = 1,
                names.arg = if (k==1) tema_lab else rep("", length(tema_lab)),
                cex.names = 0.85,
                cex.axis = 0.9,
                main = paste("Éxito:", levels(df$exito_f)[k]),
                xlab = "Proporción",
                ylab = if (k==1) "Tema" else "")


  text(x = 1.02, y = bp, labels = paste0("n=", n_list[[k]]), pos = 4, cex = 0.75)
}

par(mar=c(0,0,0,0))
plot.new()
legend("center",
       legend = levels(df$tecnica_f),
       fill = cols[levels(df$tecnica_f)],
       bty = "n",
       cex = 1)

mtext("Distribución de técnicas dentro de cada tema (separado por éxito)", outer=TRUE, cex=1.1)

layout(1)
par(op)

```


### area vs fecha

```{r, echo = F}

df$log_area <- log(df$area)

plot(df$fecha_est, df$log_area,
     main = "log(Área) vs Fecha Estimada",
     xlab = "Fecha Estimada",
     ylab = "log(Área)",
     pch = 19,  # Usar puntos sólidos
     col = rgb(0, 0, 1, 0.5),  # Color azul con algo de transparencia
     cex = 0.7)  # Tamaño de los puntos

# Añadir una línea de tendencia (si es relevante)
abline(lm(df$log_area ~ df$fecha_est), col = "red", lwd = 2)

```

La línea LOWESS es la tendencia: como está casi plana (ligeramente hacia abajo), no parece que el área cambie mucho con la fecha, las  verticales salen porque muchos años se repiten.

### area vs fecha con éxito 

```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

col_ex <- ifelse(df$exito_f == "Sí cumple", "green3", "red3")

x <- jitter(df$fecha_est, amount = 0.25)
y <- log(df$area)

plot(x, y,
     pch = 16, cex = 0.5,
     col = col_ex,
     xlab = "fecha_est",
     ylab = "log(area+1)",
     main = "Área vs fecha_est (coloreado por éxito)")

legend("topright",
       legend = c("No cumple","Sí cumple"),
       col = c("red3","green3"),
       pch = 16, bty = "n")

lines(lowess(df$fecha_est, y), lwd = 2)

lines(lowess(df$fecha_est[df$exito_f=="No cumple"], y[df$exito_f=="No cumple"]), lwd=2, col="red3")
lines(lowess(df$fecha_est[df$exito_f=="Sí cumple"], y[df$exito_f=="Sí cumple"]), lwd=2, col="green3")
```


### area por orientación 

```{r, echo = F}
boxplot(log(df$area) ~ df$orientacion, las=2,
        main="log(area) por orientación", xlab="orientación", ylab="log(area)")

```


### area por orientación con exito 

```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

df2 <- subset(df, orientacion != "cuadrado" & !is.na(area))

df2$orientacion <- droplevels(factor(df2$orientacion))
df2$exito_f      <- droplevels(df2$exito_f)

grp <- interaction(df2$orientacion, df2$exito_f, sep="\n", drop=TRUE)

col_grp <- ifelse(grepl("No cumple", levels(grp)), "red", "green")

par(mar=c(9,4,4,2)+0.1)
boxplot(log(df2$area + 1) ~ grp,
        las=2,
        col=col_grp,
        main="log(area) por orientación y éxito (sin cuadrados)",
        ylab="log(area)",
        xlab="")

legend("topright", legend=c("No cumple","Sí cumple"), fill=c("red","green"), bty="n")
```


### area por soporte


```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
with(df, table(orientacion, exito_f))
```



```{r, echo = F}
boxplot(log(df$area) ~ df$soporte_grp, las=2,
        main="log(area) por soporte", xlab="soporte", ylab="log(area)")
```


### Area por técnica 

```{r, echo = F}
boxplot(log(df$area) ~ df$tecnica_f,
        main = "Area por técnica",
        xlab = "Técnica",
        ylab = "Área",
        col = rainbow(length(levels(df$tecnica_f))),
        outline = TRUE)

```

### Area por técnica y éxito 

```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0, 1), labels=c("No cumple", "Sí cumple"))
df$tecnica_f <- factor(df$tecnica)

log_area <- log(df$area)

interaction_var <- interaction(df$tecnica_f, df$exito_f, drop=TRUE)

lst <- split(log_area, interaction_var)

cols_exito <- c("red", "green")

op <- par(no.readonly=TRUE)
par(mar=c(7,5,4,2)+0.1)

boxplot(lst,
        col=cols_exito,
        ylab="log(Área)",
        xlab="Técnica y Éxito",
        main="log(Área) por Técnica y Éxito",
        las=2,
        outline=TRUE)

axis(1, at=1:length(levels(df$tecnica_f)), labels=levels(df$tecnica_f), las=2)
abline(v=seq(2.5, by=2, length.out=length(levels(df$tecnica_f))-1), col="gray80", lty=2)

legend("topright", legend=c("No cumple", "Sí cumple"), fill=cols_exito, bty="n")

par(op)

```

### Soporte por area y exito 

```{r, echo = F}
par(mar=c(9,5,4,2)+0.1)

k2 <- length(levels(df$soporte_grp))

boxplot(y ~ df$soporte_grp * df$exito_f,
        col  = rep(cols_ex, times = k2),
        xaxt = "n",
        las  = 1,
        main = "log(area) por soporte y éxito",
        ylab = "log(area)",
        xlab = "")

axis(1,
     at = seq(1.5, by = 2, length.out = k2),
     labels = levels(df$soporte_grp),
     las = 2)

abline(v = seq(2.5, by = 2, length.out = k2-1), col = "gray80", lty = 2)

legend("topright", legend = levels(df$exito_f), fill = cols_ex, bty = "n")

par(op)
```


### orientación con soporte_grp

```{r, echo = F}
tab_orient_soporte <- table(df$orientacion, df$soporte_grp)
prop_orient_soporte <- prop.table(tab_orient_soporte, 2)

cols <- c("orange", "purple", "blue", "green")

barplot(prop_orient_soporte, 
        beside = FALSE,  # Apilar las barras
        col = cols,  # Colores para cada categoría
        ylim = c(0, 1),  # Asegurar que las barras lleguen a 1
        main = "Distribución de orientación por soporte_grp", 
        xlab = "Soporte", 
        ylab = "Proporción", 
        las = 1) 

legend("topright", 
       legend = rownames(prop_orient_soporte), 
       fill = cols, 
       bty = "n", 
       cex = 0.9)

```

### orientación con soporte_grp con éxito

```{r, echo = F}
ori <- factor(df$orientacion)
sup <- factor(df$soporte_grp)
ex  <- factor(df$exito, levels = c(0,1), labels = c("No cumple","Sí cumple"))

ok <- !is.na(ori) & !is.na(sup) & !is.na(ex)
ori <- ori[ok]; sup <- sup[ok]; ex <- ex[ok]

tab <- table(ori, sup, ex)

ori_levels <- dimnames(tab)[[1]]
sup_levels <- dimnames(tab)[[2]]
ex_levels  <- dimnames(tab)[[3]]

cols_ori <- rainbow(length(ori_levels)) 

op <- par(no.readonly = TRUE)
par(mfrow = c(1,2), mar = c(7,4,4,1) + 0.1, xpd = NA)

for(i in seq_along(ex_levels)){
  m <- tab[,, i, drop = FALSE]
  m <- m[,,1] 

  prop <- prop.table(m, 2)    
  prop[!is.finite(prop)] <- 0   

  barplot(as.matrix(prop),
          beside = FALSE,
          ylim = c(0,1),
          col = cols_ori,
          main = paste("Éxito:", ex_levels[i]),
          xlab = "soporte_grp",
          ylab = "Proporción",
          las = 2)

  abline(h = seq(0,1,0.2), col = "gray90")
}

legend("topright", inset = c(-0.25, 0),
       legend = ori_levels, fill = cols_ori, bty = "n", cex = 0.9)

par(op)

```


### orientación con técniva 

```{r, echo = F}
ori <- factor(df$orientacion)
tec <- factor(df$tecnica)

ok <- !is.na(ori) & !is.na(tec)
ori <- ori[ok]; tec <- tec[ok]

tab <- table(ori, tec)          
prop <- prop.table(tab, 2) 

cols_ori <- rainbow(nlevels(ori))

op <- par(no.readonly=TRUE)
par(mar=c(7,4,4,2)+0.1, xpd=NA)

barplot(as.matrix(prop),
        beside = FALSE,
        ylim = c(0,1),
        col = cols_ori,
        main = "Distribución de orientación dentro de cada técnica",
        xlab = "Técnica",
        ylab = "Proporción",
        las = 2)

abline(h = seq(0,1,0.2), col="gray")
legend("topright", inset=c(-0.25,0),
       legend=levels(ori), fill=cols_ori, bty="n", cex=0.9)

par(op)

```

### orientación con técniva con exito 

```{r, echo = F}
ori <- factor(df$orientacion)
tec <- factor(df$tecnica)
ex  <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

ok <- !is.na(ori) & !is.na(tec) & !is.na(ex)
ori <- ori[ok]; tec <- tec[ok]; ex <- ex[ok]

tab <- table(ori, tec, ex)

ori_levels <- dimnames(tab)[[1]]
tec_levels <- dimnames(tab)[[2]]
ex_levels  <- dimnames(tab)[[3]]

cols_ori <- rainbow(length(ori_levels))

op <- par(no.readonly=TRUE)
par(mfrow=c(1,2), mar=c(7,4,4,1)+0.1, xpd=NA)

for(i in seq_along(ex_levels)){
  m <- tab[,,i]
  prop <- prop.table(m, 2)
  prop[!is.finite(prop)] <- 0

  barplot(as.matrix(prop),
          beside=FALSE,
          ylim=c(0,1),
          col=cols_ori,
          main=paste("Éxito:", ex_levels[i]),
          xlab="Técnica",
          ylab="Proporción",
          las=2)

  abline(h=seq(0,1,0.2), col="gray90")
}

legend("topright", inset=c(-0.25,0),
       legend=ori_levels, fill=cols_ori, bty="n", cex=0.9)

par(op)

```


### orientación fecha_est

```{r, echo = F}
df$orientacion <- factor(df$orientacion)
df$fecha_est_num <- as.numeric(df$fecha_est)  

boxplot(fecha_est_num ~ orientacion,
        data = df,
        col = rainbow(length(levels(df$orientacion))),
        main = "Distribución de fecha_est por orientación",
        xlab = "Orientación",
        ylab = "Fecha Estimada",
        las = 2) 

```

### orientación fecha_est con exito 

```{r, echo = F}
ori <- factor(df$orientacion)
ex  <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
fe  <- as.numeric(df$fecha_est)

ok <- !is.na(ori) & !is.na(ex) & is.finite(fe)
ori <- ori[ok]; ex <- ex[ok]; fe <- fe[ok]

# Colores por orientación (mismos en ambos paneles)
ori_levels <- levels(ori)
cols_ori <- c("blue", "orange", "gray")
cols_ori <- cols_ori[seq_along(ori_levels)]  # por si hay 2 o 3 niveles

op <- par(no.readonly=TRUE)
par(mfrow=c(1,2), mar=c(7,4,4,5)+0.1)

for (lev in levels(ex)) {
  idx <- ex == lev
  boxplot(fe[idx] ~ ori[idx],
          las = 2,
          col = cols_ori,
          main = paste("fecha_est por orientación (", lev, ")", sep=""),
          xlab = "Orientación",
          ylab = "Fecha estimada",
          outline = TRUE)
  
  legend("topright", legend=ori_levels, fill=cols_ori, bty="n", cex=0.9)
}

par(op)

```


### soporte_grp x tecnica 


```{r, echo = F}
sup <- factor(df$soporte_grp)
tec <- factor(df$tecnica)

ok <- !is.na(sup) & !is.na(tec)
sup <- sup[ok]; tec <- tec[ok]

tab  <- table(tec, sup) 
prop <- prop.table(tab, 2)     

cols_tec <- rainbow(nrow(prop)) 

op <- par(no.readonly=TRUE)
par(mar=c(7,4,4,10)+0.1, xpd=NA) 

bp <- barplot(as.matrix(prop),
              beside = FALSE,
              ylim = c(0,1),
              col = cols_tec,
              main = "Distribución de técnica dentro de cada soporte",
              xlab = "soporte_grp",
              ylab = "Proporción",
              las = 2)

abline(h = seq(0,1,0.2), col="gray90")

n_sup <- colSums(tab)
text(x = bp, y = 1.02, labels = paste0("n=", n_sup), cex = 0.8)

legend("topright",
       inset = c(-0.35, 0),
       legend = rownames(prop),
       fill = cols_tec,
       bty = "n",
       cex = 0.9)

par(op)

```


### soporte_grp x tecnica con exito 

```{r, echo = F}
sup <- factor(df$soporte_grp)
tec <- factor(df$tecnica)
ex  <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

ok <- !is.na(sup) & !is.na(tec) & !is.na(ex)
sup <- sup[ok]; tec <- tec[ok]; ex <- ex[ok]

tab <- table(tec, sup, ex) 

tec_levels <- dimnames(tab)[[1]]
sup_levels <- dimnames(tab)[[2]]
ex_levels  <- dimnames(tab)[[3]]

cols_tec <- rainbow(length(tec_levels)) 

op <- par(no.readonly=TRUE)
par(mfrow=c(1,2), mar=c(7,4,4,10)+0.1, xpd=NA)

for(i in seq_along(ex_levels)){
  m <- tab[,,i]
  prop <- prop.table(m, 2)     
  prop[!is.finite(prop)] <- 0   

  bp <- barplot(as.matrix(prop),
                beside=FALSE,
                ylim=c(0,1),
                col=cols_tec,
                main=paste("Éxito:", ex_levels[i]),
                xlab="soporte_grp",
                ylab="Proporción",
                las=2)

  abline(h=seq(0,1,0.2), col="gray")

  n_sup <- colSums(m)
  text(x=bp, y=1.02, labels=paste0("n=", n_sup), cex=0.8)
}

legend("topright", inset=c(-0.35,0),
       legend=tec_levels, fill=cols_tec, bty="n", cex=0.9)

par(op)

```


### soporte_grp x fecha_estimada 

```{r, echo = F}
sup <- factor(df$soporte_grp)
fe  <- as.numeric(df$fecha_est)

ok <- !is.na(sup) & is.finite(fe)
sup <- sup[ok]; fe <- fe[ok]

sup_levels <- levels(sup)
cols_sup <- rainbow(length(sup_levels))

op <- par(no.readonly=TRUE)
par(mar=c(7,4,4,2)+0.1)

boxplot(fe ~ sup,
        col = cols_sup,
        las = 2,
        main = "fecha_est por soporte_grp",
        xlab = "soporte_grp",
        ylab = "Fecha estimada",
        outline = TRUE)

legend("topright", legend=sup_levels, fill=cols_sup, bty="n", cex=0.85)

par(op)

```



### soporte_grp x fecha_estimada con exito 

```{r, echo = F}
sup <- factor(df$soporte_grp)
ex  <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
fe  <- as.numeric(df$fecha_est)

ok <- !is.na(sup) & !is.na(ex) & is.finite(fe)
sup <- sup[ok]; ex <- ex[ok]; fe <- fe[ok]

sup_levels <- levels(sup)
cols_sup <- rainbow(length(sup_levels))

op <- par(no.readonly=TRUE)
par(mfrow=c(1,2), mar=c(7,4,4,5)+0.1, xpd=NA)

for(lev in levels(ex)){
  idx <- ex == lev
  boxplot(fe[idx] ~ sup[idx],
          col = cols_sup,
          las = 2,
          main = paste("fecha_est por soporte_grp (", lev, ")", sep=""),
          xlab = "soporte_grp",
          ylab = "Fecha estimada",
          outline = TRUE)
  legend("topright", legend=sup_levels, fill=cols_sup, bty="n", cex=0.85)
}

par(op)

```


### técnica x fecha_estimada

```{r, echo = F}
tec <- factor(df$tecnica)
fe  <- as.numeric(df$fecha_est)

ok <- !is.na(tec) & is.finite(fe)
tec <- tec[ok]; fe <- fe[ok]

tec_levels <- levels(tec)
cols_tec <- rainbow(length(tec_levels))

op <- par(no.readonly=TRUE)
par(mar=c(7,4,4,6)+0.1, xpd=NA)

boxplot(fe ~ tec,
        col = cols_tec,
        las = 2,
        main = "fecha_est por técnica",
        xlab = "Técnica",
        ylab = "Fecha estimada",
        outline = TRUE)

legend("topright", inset=c(-0.25,0),
       legend=tec_levels, fill=cols_tec, bty="n", cex=0.9)

par(op)

```



### técnica x fecha_estimada con exito 

```{r, echo = F}
tec <- factor(df$tecnica)
ex  <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
fe  <- as.numeric(df$fecha_est)

ok <- !is.na(tec) & !is.na(ex) & is.finite(fe)
tec <- tec[ok]; ex <- ex[ok]; fe <- fe[ok]

tec_levels <- levels(tec)
cols_tec <- rainbow(length(tec_levels))

op <- par(no.readonly=TRUE)
par(mfrow=c(1,2), mar=c(7,4,4,8)+0.1, xpd=NA)

for(lev in levels(ex)){
  idx <- ex == lev
  boxplot(fe[idx] ~ tec[idx],
          col = cols_tec,
          las = 2,
          main = paste("fecha_est por técnica (", lev, ")", sep=""),
          xlab = "Técnica",
          ylab = "Fecha estimada",
          outline = TRUE)
  legend("topright", inset=c(-0.30,0),
         legend=tec_levels, fill=cols_tec, bty="n", cex=0.85)
}

par(op)

```



## tipo autor 


```{r, echo = F}
df$exito_f <- factor(df$exito, levels = c(0,1), labels = c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)
df$orientacion_f <- factor(df$orientacion)
df$soporte_f <- factor(df$soporte_grp)
df$tecnica_f <- factor(df$tecnica)
df$tema_f <- factor(df$tema)

if (is.numeric(df$serie) || is.integer(df$serie)) {
  df$serie_f <- factor(df$serie, levels = c(0,1),
                       labels = c("No pertenece a serie","Pertenece a serie"))
} else {
  df$serie_f <- factor(df$serie)
}

if (is.numeric(df$sop_montaje) || is.integer(df$sop_montaje)) {
  df$sop_montaje_f <- factor(df$sop_montaje, levels = c(0,1),
                             labels = c("No montaje","Sí montaje"))
} else {
  df$sop_montaje_f <- factor(df$sop_montaje)
}


df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)

# tam_cat: si está roto (todo NA), lo reconstruimos desde area
if ("tam_cat" %in% names(df)) {
  if (all(is.na(df$tam_cat))) {
    qs <- quantile(df$area, probs=c(1/3, 2/3), na.rm=TRUE)
    df$tam_cat <- cut(df$area,
                      breaks=c(-Inf, qs[1], qs[2], Inf),
                      labels=c("pequeno","mediano","grande"),
                      include.lowest=TRUE, ordered_result=TRUE)
  } else {
    df$tam_cat <- factor(as.character(df$tam_cat), ordered=TRUE)
    if (all(c("pequeno","mediano","grande") %in% levels(df$tam_cat))) {
      df$tam_cat <- factor(df$tam_cat, levels=c("pequeno","mediano","grande"), ordered=TRUE)
    }
  }
}

# serie y sop_montaje por si vienen como 0/1 numérico
if ("serie" %in% names(df) && (is.numeric(df$serie) || is.integer(df$serie))) {
  df$serie <- factor(df$serie, levels=c(0,1), labels=c("No serie","Sí serie"))
} else if ("serie" %in% names(df)) df$serie <- factor(df$serie)

if ("sop_montaje" %in% names(df) && (is.numeric(df$sop_montaje) || is.integer(df$sop_montaje))) {
  df$sop_montaje <- factor(df$sop_montaje, levels=c(0,1), labels=c("No montaje","Sí montaje"))
} else if ("sop_montaje" %in% names(df)) df$sop_montaje <- factor(df$sop_montaje)

# factores típicos
if ("orientacion" %in% names(df)) df$orientacion <- factor(df$orientacion)
if ("soporte_grp" %in% names(df)) df$soporte_grp <- factor(df$soporte_grp)
if ("tecnica" %in% names(df)) df$tecnica <- factor(df$tecnica)
if ("tema" %in% names(df)) df$tema <- factor(df$tema)
if ("fecha_est" %in% names(df)) df$fecha_est <- as.integer(df$fecha_est)
if ("area" %in% names(df)) df$area <- as.numeric(df$area)

# colapsar categorías si hay muchísimas (para que se lea)
collapse_top <- function(f, top=12){
  f <- factor(f)
  tab <- sort(table(f), decreasing=TRUE)
  keep <- names(tab)[seq_len(min(top, length(tab)))]
  out <- as.character(f)
  out[!(out %in% keep)] <- "Otros"
  factor(out, levels=c(keep, "Otros"))
}

```


## tipo de autor vs tema
```{r, echo = F}
tab <- table(df$tipo_autor, df$tema)
prop <- prop.table(tab, 1)
n <- rowSums(tab)

tema_levels <- colnames(prop)
cols <- grDevices::rainbow(length(tema_levels))

par(mar=c(9,4,4,12)+0.1)  
bp <- barplot(t(prop),
              beside=FALSE, ylim=c(0,1), las=2,
              col=cols,
              main="Temas por cada tipo de autor",
              ylab="Proporción", xlab="Tipo de autor")
text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)

legend("topright", inset=c(-0.35,0), xpd=TRUE,
       legend=tema_levels, fill=cols, bty="n", cex=0.8)

tab
round(prop, 3)

```

Los temas no se reparten igual según el tipo de autor: cambian bastante entre anónimo, hombre, mujer y varios.
Pero “mujer” y “varios” tienen muy pocos casos, así que ahí las proporciones pueden engañar.
Esto sugiere que tipo_autor y tema están relacionados, así que si metemos uno en el modelo el otro puede aportar poco (o habría que agrupar categorías).

## tipo_auto vs tema con exito 

```{r, echo = F}

df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)
df$tema_f <- factor(df$tema)

tab3 <- with(df, table(tipo_autor_f, tema_f, exito_f))

tab_total <- apply(tab3, c(1,2), sum)     
tema_tot  <- colSums(tab_total) 
ord_tema  <- order(tema_tot, decreasing = TRUE)

tab3 <- tab3[, ord_tema, , drop=FALSE]
tema_levels <- dimnames(tab3)[[2]]

tema_lab <- gsub("_", "\n", tema_levels)

cols <- grDevices::rainbow(length(tema_levels))
names(cols) <- tema_levels

op <- par(no.readonly = TRUE)

layout(matrix(c(1,2,3), 1, 3), widths = c(5.2, 5.2, 2.2))
par(oma=c(0,0,2,0))

for (k in 1:length(levels(df$exito_f))) {

  tab_k <- tab3[, , k, drop=FALSE][,,1] 
  prop  <- prop.table(tab_k, 1)                  
  prop[is.na(prop)] <- 0
  n_aut <- rowSums(tab_k)

  par(mar=c(9,4,4,1)+0.1, xpd=NA)

  bp <- barplot(t(prop),
                beside = FALSE,
                ylim = c(0,1),
                las = 2,
                col = cols[colnames(prop)],
                main = paste("Éxito:", levels(df$exito_f)[k]),
                ylab = "Proporción",
                xlab = "Tipo de autor")

  text(x=bp, y=1.02, labels=paste0("n=", n_aut), xpd=TRUE, cex=0.8)
}

par(mar=c(0,0,0,0))
plot.new()
legend("center",
       legend = tema_lab,
       fill = cols[tema_levels],
       bty = "n",
       cex = 0.75)

mtext("Temas por cada tipo_autor separado por éxito", outer=TRUE, cex=1.1)

layout(1)
par(op)

```

La distribución de temas por tipo de autor es bastante parecida entre “No cumple” y “Sí cumple”, no se ve un cambio claro que explique el éxito.
Los grupos “mujer” y “varios” tienen muy pocos casos (n muy pequeño), así que cualquier diferencia ahí puede ser casualidad.
En el descriptivo, tipo_autor no parece una variable clave para el modelo; si metemos tema, tipo_autor probablemente aportará poco.

## tipo_autor vs tecnica
```{r, echo = F}
tab <- table(df$tipo_autor, df$tecnica)
prop <- prop.table(tab, 1)
n <- rowSums(tab)

tec_levels <- colnames(prop)
cols <- grDevices::rainbow(length(tec_levels))

par(mar=c(9,4,4,10)+0.1)
bp <- barplot(t(prop),
              beside=FALSE, ylim=c(0,1), las=2,
              col=cols,
              main="Distribución de técnicas dentro de cada tipo de autor",
              ylab="Proporción", xlab="Tipo de autor")
text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)

legend("topright", inset=c(-0.25,0), xpd=TRUE,
       legend=tec_levels, fill=cols, bty="n", cex=0.9)

tab
round(prop, 3)

```

Casi todo es óleo en anónimo/hombre/mujer, así que la técnica apenas cambia entre autores.
Con tan poca diferencia, esta variable no parece que vaya a ayudar mucho a explicar el éxito (da poca “señal”).
No debería ser prioritaria en el modelo; solo tendría sentido si en el gráfico técnica vs éxito se viera una diferencia clara.

## tipo_autor vs tecnica con exito 

```{r, echo = F}

df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)
df$tecnica_f <- factor(df$tecnica)

tab3 <- with(df, table(tipo_autor_f, tecnica_f, exito_f))

tab_total <- apply(tab3, c(1,2), sum)
tec_tot   <- colSums(tab_total)   
ord_tec   <- order(tec_tot, decreasing = TRUE)

tab3 <- tab3[, ord_tec, , drop=FALSE]
tec_levels <- dimnames(tab3)[[2]]

tec_lab <- gsub("_", "\n", tec_levels)

cols <- grDevices::rainbow(length(tec_levels))
names(cols) <- tec_levels

op <- par(no.readonly = TRUE)

layout(matrix(c(1,2,3), 1, 3), widths = c(5.2, 5.2, 2.2))
par(oma=c(0,0,2,0))

for (k in 1:length(levels(df$exito_f))) {

  tab_k <- tab3[, , k, drop=FALSE][,,1]
  prop  <- prop.table(tab_k, 1)             
  prop[is.na(prop)] <- 0
  n_aut <- rowSums(tab_k)

  par(mar=c(9,4,4,1)+0.1, xpd=NA)

  bp <- barplot(t(prop),
                beside = FALSE,
                ylim = c(0,1),
                las = 2,
                col = cols[colnames(prop)],
                main = paste("Éxito:", levels(df$exito_f)[k]),
                ylab = "Proporción",
                xlab = "Tipo de autor")

  text(x=bp, y=1.02, labels=paste0("n=", n_aut), xpd=TRUE, cex=0.8)
}

par(mar=c(0,0,0,0))
plot.new()
legend("center",
       legend = tec_lab,
       fill = cols[tec_levels],
       bty = "n",
       cex = 0.9)

mtext("Técnicas por cada tipo_autor separado por éxito", outer=TRUE, cex=1.1)

layout(1)
par(op)

```

## tipo_autor vs soporte_grp
```{r, echo = F}
tab <- table(df$tipo_autor, df$soporte_grp)
prop <- prop.table(tab, 1)
n <- rowSums(tab)

sup_levels <- colnames(prop)
cols <- grDevices::rainbow(length(sup_levels))

par(mar=c(9,4,4,10)+0.1)
bp <- barplot(t(prop),
              beside=FALSE, ylim=c(0,1), las=2,
              col=cols,
              main="Distribución de soportes dentro de cada tipo de autor",
              ylab="Proporción", xlab="Tipo de autor")
text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)

legend("topright", inset=c(-0.25,0), xpd=TRUE,
       legend=sup_levels, fill=cols, bty="n", cex=0.9)

tab
round(prop, 3)

```

## tipo_autor vs soporte_grp con exito
```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)
df$soporte_f <- factor(df$soporte_grp)

tab3 <- with(df, table(tipo_autor_f, soporte_f, exito_f))

tab_total <- apply(tab3, c(1,2), sum)  
sup_tot   <- colSums(tab_total)  
ord_sup   <- order(sup_tot, decreasing = TRUE)

tab3 <- tab3[, ord_sup, , drop=FALSE]
sup_levels <- dimnames(tab3)[[2]]

sup_lab <- sup_levels
sup_lab <- gsub("Papel/Vitela", "Papel/\nVitela", sup_lab)
sup_lab <- gsub("Tabla/Panel", "Tabla/\nPanel", sup_lab)

cols <- grDevices::rainbow(length(sup_levels))
names(cols) <- sup_levels

op <- par(no.readonly = TRUE)

layout(matrix(c(1,2,3), 1, 3), widths = c(5.2, 5.2, 2.2))
par(oma=c(0,0,2,0))

for (k in 1:length(levels(df$exito_f))) {

  tab_k <- tab3[, , k, drop=FALSE][,,1]   
  prop  <- prop.table(tab_k, 1)
  prop[is.na(prop)] <- 0
  n_aut <- rowSums(tab_k)

  par(mar=c(9,4,4,1)+0.1, xpd=NA)

  bp <- barplot(t(prop),
                beside = FALSE,
                ylim = c(0,1),
                las = 2,
                col = cols[colnames(prop)],
                main = paste("Éxito:", levels(df$exito_f)[k]),
                ylab = "Proporción",
                xlab = "Tipo de autor")

  text(x=bp, y=1.02, labels=paste0("n=", n_aut), xpd=TRUE, cex=0.8)
}

# Panel leyenda aparte
par(mar=c(0,0,0,0))
plot.new()
legend("center",
       legend = sup_lab,
       fill = cols[sup_levels],
       bty = "n",
       cex = 0.9)

mtext("Soportes en cada tipo_autor separado por éxito", outer=TRUE, cex=1.1)

layout(1)
par(op)

```


## tam_cat vs tipo de autor

```{r, echo = F}

table(df$tam_cat, useNA = "ifany")
tam_raw <- df$tam_cat

if (all(is.na(tam_raw))) {
  # RECREAR tam_cat desde area (terciles)
  qs <- quantile(df$area, probs = c(1/3, 2/3), na.rm = TRUE)
  df$tam_cat <- cut(df$area,
                    breaks = c(-Inf, qs[1], qs[2], Inf),
                    labels = c("pequeno", "mediano", "grande"),
                    include.lowest = TRUE, ordered_result = TRUE)
} else {
  df$tam_cat <- factor(as.character(tam_raw))
}

if (all(c("pequeno","mediano","grande") %in% levels(df$tam_cat))) {
  df$tam_cat <- factor(df$tam_cat, levels = c("pequeno","mediano","grande"), ordered = TRUE)
}

df$tipo_autor_f <- factor(df$tipo_autor)

tab <- table(df$tipo_autor_f, df$tam_cat)
prop <- prop.table(tab, 1)
n <- rowSums(tab)

tam_levels <- colnames(prop)
cols <- grDevices::heat.colors(length(tam_levels))

par(mar=c(9,4,4,10)+0.1)
bp <- barplot(t(prop),
              beside = FALSE, ylim = c(0,1), las = 2,
              col = cols,
              main = "tam_cat en cada tipo de autor",
              ylab = "Proporción", xlab = "Tipo de autor")

text(x = bp, y = 1.02, labels = paste0("n=", n), xpd = TRUE, cex = 0.8)

legend("topright", inset=c(-0.25,0), xpd=TRUE,
       legend = tam_levels, fill = cols, bty = "n", cex = 0.9)

tab
round(prop, 3)

```

## tam_cat vs tipo de autor con exito 

```{r, echo = F}
tab <- table(df$tam_cat, df$tipo_autor, df$exito)

prop <- prop.table(tab, 1) 
prop_matrix <- apply(prop, c(1, 2), sum)

cols_ex <- c("red", "green") 
op <- par(no.readonly = TRUE)
par(mar = c(6, 4, 4, 2) + 0.1)

bp <- barplot(t(prop_matrix), 
              beside = FALSE,  
              col = cols_ex,
              ylim = c(0, 1),
              main = " Tam_cat por tipo de autor y éxito",
              xlab = "Tipo de autor",
              ylab = "Proporción",
              legend.text = c("No cumple", "Sí cumple"),
              args.legend = list(x = "topright", bty = "n"))

n_totals <- rowSums(tab[,,1] + tab[,,2])  
text(x = bp, y = 1.02, labels = paste0("n=", n_totals), xpd = TRUE, cex = 0.8)

par(op)

```


## tipo_autor vs orientacion
```{r, echo = F}
tab <- table(df$tipo_autor, df$orientacion)
prop <- prop.table(tab, 1)
n <- rowSums(tab)

ori_levels <- colnames(prop)
cols <- c("gray50","orange2","skyblue3")[seq_along(ori_levels)]  # ajusta si quieres

par(mar=c(9,4,4,2)+0.1)
bp <- barplot(t(prop),
              beside=FALSE, ylim=c(0,1), las=2,
              col=cols,
              main="Distribución de orientación dentro de cada tipo de autor",
              ylab="Proporción", xlab="Tipo de autor")
legend("topright", legend=ori_levels, fill=cols, bty="n")
text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)

tab
round(prop, 3)

```

Este gráfico muestra la distribución de la orientación de las obras (horizontal, vertical, cuadrado) según el tipo de autor.
Las obras de autores anónimos y hombres son predominantemente horizontales, mientras que las obras de mujeres y varios presentan una mayor proporción de obras verticales.
Esta variable (orientación) podría ser relevante para el modelo si se confirma que influye en el éxito, ya que hay diferencias visibles en la distribución por tipo de autor.

## tipo_autor vs area (boxplot de log(area))

```{r, echo = F}
y <- log(df$area)

par(mar=c(9,4,4,2)+0.1)
boxplot(y ~ df$tipo_autor, las=2,
        main="log(area) por tipo de autor",
        xlab="Tipo de autor", ylab="log(area)")

```


## area por tipo de autor y exito 

```{r, echo = F}
 df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)

area_num <- as.numeric(df$area)
ok <- is.finite(area_num) & area_num > 0 & !is.na(df$exito_f) & !is.na(df$tipo_autor_f)

y  <- log(area_num[ok])
ta <- df$tipo_autor_f[ok]
ex <- df$exito_f[ok]

g   <- interaction(ta, ex, sep="|", drop=TRUE)
lst <- split(y, g)

ord_names <- as.vector(sapply(levels(ta), function(a) paste(a, levels(ex), sep="|")))
ord_names <- ord_names[ord_names %in% names(lst)]
lst <- lst[ord_names]

k1 <- nlevels(ta)
centers <- seq(1.5, by=2, length.out=k1)
at <- as.vector(sapply(centers, function(cc) cc + c(-0.35, 0.35)))
at <- at[seq_along(lst)]

cols_ex <- c("red","green")
col_vec <- rep(cols_ex, times=k1)[seq_along(lst)]

op <- par(no.readonly=TRUE)
par(mar=c(8,5,4,2)+0.1)  # Aumentar el margen inferior para mejorar la visibilidad de las etiquetas

boxplot(lst,
        at=at,
        col=col_vec,
        ylab="log(area)",
        xlab="Tipo de autor",
        main="log(area) por tipo de autor y éxito",
        las=2,  # Rotar las etiquetas del eje y
        outline=TRUE)

axis(1, at=centers, labels=levels(ta), las=2)  # Rotar las etiquetas del eje X
abline(v=seq(2.5, by=2, length.out=k1-1), col="gray80", lty=2)
legend("topright", legend=levels(ex), fill=cols_ex, bty="n")

par(op)

```

## tipo_autor vs fecha_est 

```{r, echo = F}
df$tipo_autor_f <- factor(df$tipo_autor)

# Asegúrate de que 'fecha_est' sea numérico
fe <- as.numeric(df$fecha_est)

# Elimina las filas con datos no válidos (NA y negativos)
ok <- is.finite(fe) & !is.na(df$tipo_autor_f)

y  <- fe[ok]
ta <- df$tipo_autor_f[ok]

# Crear el boxplot
op <- par(no.readonly=TRUE)
par(mar=c(7,5,4,2)+0.1)  # Margen para mejorar la legibilidad

# Crear el boxplot de fecha_est por tipo de autor
boxplot(y ~ ta,
        col=c("blue", "pink", "yellow", "green"),
        ylab="Fecha Estimada (fecha_est)",
        xlab="Tipo de autor",
        main="Fecha estimada por tipo de autor",
        las=2,  # Rotar etiquetas del eje X
        outline=TRUE)  # Incluir valores atípicos

# Ajuste de los ejes
axis(1, at=seq_along(levels(ta)), labels=levels(ta), las=2)

par(op)  # Restaurar la configuración original

```

## tipo_autor vs fecha_est con exito 
```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))
df$tipo_autor_f <- factor(df$tipo_autor)

fe <- as.numeric(df$fecha_est)

ok <- is.finite(fe) & !is.na(df$exito_f) & !is.na(df$tipo_autor_f)

y  <- fe[ok]
ta <- df$tipo_autor_f[ok]
ex <- df$exito_f[ok]

lev_ta <- levels(ta)
lev_ex <- levels(ex)

# CLAVE: mismo separador que usas al ordenar
g <- interaction(ta, ex, sep="|", drop=TRUE)
lst <- split(y, g)

ord_names <- as.vector(sapply(lev_ta, function(a) paste(a, lev_ex, sep="|")))
ord_names <- ord_names[ord_names %in% names(lst)]
lst <- lst[ord_names]

k1 <- length(lev_ta)
centers <- seq(1.5, by=2, length.out=k1)
at <- as.vector(sapply(centers, function(cc) cc + c(-0.35, 0.35)))
at <- at[seq_along(lst)]

cols_ex <- c("red","green")
col_vec <- rep(cols_ex, times=k1)[seq_along(lst)]

op <- par(no.readonly=TRUE)
par(mar=c(7,5,4,2)+0.1)

boxplot(lst,
        at=at,
        col=col_vec,
        ylab="fecha_est (año)",
        xlab="Tipo de autor",
        main="Fecha estimada por tipo de autor y éxito",
        las=2,
        outline=TRUE)

axis(1, at=centers, labels=lev_ta, las=2)
abline(v=seq(2.5, by=2, length.out=k1-1), col="gray80", lty=2)
legend("topright", legend=lev_ex, fill=cols_ex, bty="n")

par(op)

```


## tipo_autor vs serie
```{r, echo = F}
tab <- table(df$tipo_autor, df$serie)
prop <- prop.table(tab, 1)
n <- rowSums(tab)

ser_levels <- colnames(prop)
cols <- c("yellow","lightblue")[seq_along(ser_levels)]

par(mar=c(9,4,4,2)+0.1)
bp <- barplot(t(prop),
              beside=FALSE, ylim=c(0,1), las=2,
              col=cols,
              main="Serie dentro de cada tipo de autor",
              ylab="Proporción", xlab="Tipo de autor")
legend("topright", legend=ser_levels, fill=cols, bty="n")
text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)

tab
round(prop, 3)

```


## tipo_autor vs serie con exito 

```{r, echo = F}
df$exito_f <- factor(df$exito, levels=c(0,1), labels=c("No cumple","Sí cumple"))

df$serie_f <- factor(df$serie, levels=c(0,1),
                     labels=c("0 (con serie)", "1 (con serie)"))

df$tipo_autor_f <- factor(df$tipo_autor)

tab3 <- table(df$tipo_autor_f, df$serie_f, df$exito_f)

cols_ex <- c("red","green")

op <- par(no.readonly=TRUE)
par(mfrow=c(1,2), mar=c(7,4,4,2)+0.1)

for (s in levels(df$serie_f)) {

  tab_s <- tab3[, s, ]      
  prop  <- prop.table(tab_s, 1)
  bp <- barplot(t(prop),
                beside=FALSE,
                ylim=c(0,1),
                las=2,
                col=cols_ex,
                main=paste("Serie:", s),
                ylab="Proporción",
                xlab="Tipo de autor")

  n <- rowSums(tab_s)
  text(x=bp, y=1.02, labels=paste0("n=", n), xpd=TRUE, cex=0.8)
}

legend("topright", legend=levels(df$exito_f), fill=cols_ex, bty="n")
par(op)

```



### CONCLUSIONES

Hemos revisado todos los gráficos para entender qué variables podrían estar relacionadas con exito, que es nuestra variable respuesta (sí cumple o no cumple la proporción áurea). 

La variable que más destaca en los gráficos es fecha_estimada. Al separar las obras por exito, observamos que las que sí cumplen tienden a concentrarse más en un rango de fechas mientras que las que no cumplen aparecen más dispersas y con más valores extremos. Además, esta dispersión no es igual para todos: por tipo_autor vemos mucha más variación en hombre y en parte en anónimo, mientras que mujer y varios están más concentrados, pero aquí insistimos en que mujer y varios tienen pocos datos y eso puede generar ruido. Con area ocurre algo parecido: el área es muy asimétrica y por eso trabajamos con log(area). En los boxplots log(area) parece cambiar algo entre grupos y en algunos casos hay cierta separación entre sí/no aunque menos marcada que con fecha_estimada. Esto sugiere que el tamaño podría tener relación con el éxito pero probablemente de forma más débil o más dependiente del contexto.

En cuanto a las variables categóricas (soporte_grp, tecnica, orientacion, tema, tam_cat y serie) los gráficos indican sobre todo que describen cómo se distribuyen las obras y que muchas de ellas están relacionadas entre sí. Por ejemplo tema cambia bastante según tipo_autor, y soporte y tecnica están muy conectadas con la fecha (aparecen más en unas épocas que en otras). Esto es importante en un estudio explicativo porque significa que algunas asociaciones aparentes con exito pueden estar “mezcladas” con otra variable (especialmente con la fecha). Por eso, más que buscar reglas simples del tipo “este soporte siempre cumple más”, interpretamos que el éxito puede estar influido por un conjunto de factores relacionados y que el modelo nos servirá para separar efectos y controlar posibles confusiones entre variables.

Finalmente, nosotros consideramos interacciones solo cuando los gráficos sugieren que una relación depende del grupo. Una interacción significa que el efecto de una variable no es igual para todos los niveles de otra. En nuestros gráficos la fecha se distribuye de manera muy distinta según soporte, técnica y tipo de autor, y al separar por exito parece que la diferencia entre sí/no no es idéntica en todos los grupos. 


### HIPÓTESIS Y PLANTEAMIENTO DEL MODELO 

Formulamos hipótesis para explicar exito y ordenamos el modelo según lo que sugieren los gráficos. La primera hipótesis es que fecha_estimada afecta a exito, ya que al separar por sí/no se observa un patrón consistente de mayor concentración temporal en los casos que sí cumplen y mayor dispersión en los que no cumplen. 

La segunda hipótesis es que el tamaño afecta a exito, por lo que incluimos log(area) (en lugar de area) para trabajar en una escala más estable y menos dominada por valores extremos.

Respecto a tema, nuestra hipótesis es que no afecta de manera clara al éxito según el descriptivo, pero lo incluimos como análisis alternativo porque forma parte del planteamiento y justifica el trabajo de construirlo a partir del título; comprobamos si añade explicación o si su aparente relación se debe a que tema está asociado a otras variables. También mantenemos técnica y soporte en el modelo porque son variables relevantes del contexto material de la obra y porque en los gráficos se relacionan con fecha y tamaño, de modo que pueden actuar como factores explicativos o de ajuste incluso aunque su relación directa con exito no sea uniforme.

En cuanto a interacciones, para un enfoque explicativo proponemos como interacción principal soporte_grp × log(area); la medida no significa lo mismo en todos los soportes (por ejemplo, un mural y un lienzo tienen rangos y usos distintos), por lo que es razonable que la relación entre tamaño y exito dependa del soporte. Somos conscientes de que esta interacción puede generar problemas si hay combinaciones con pocos casos, por lo que la controlamos agrupando categorías poco frecuentes y revisando que no existan celdas casi vacías. En cambio no priorizamos soporte_grp × sop_montaje porque en el análisis descriptivo no aparece un patrón claro y estable asociado al éxito aun así puede mencionarse como posibilidad secundaria y contrastarse si la teoría o el guion de la asignatura lo requiere.

